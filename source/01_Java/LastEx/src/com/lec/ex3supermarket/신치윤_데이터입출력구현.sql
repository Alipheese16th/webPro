-- 테이블 시퀀스 삭제
DROP TABLE CUSTOMER;
DROP TABLE GRADE;
DROP SEQUENCE CUSTOMER_CID_SEQ;

-- 테이블 시퀀스 생성

CREATE TABLE GRADE(
    GNO NUMBER(1) PRIMARY KEY,
    GRADE VARCHAR2(30) NOT NULL,
    LAMOUNT NUMBER(8) NOT NULL,
    HIAMOUNT NUMBER(8) NOT NULL
);
SELECT * FROM GRADE;

CREATE TABLE CUSTOMER(
    CID NUMBER(7) PRIMARY KEY,
    CTEL VARCHAR2(30) UNIQUE NOT NULL,
    CNAME VARCHAR2(30) NOT NULL,
    CPOINT NUMBER(8) CHECK(CPOINT>=0),
    CAMOUNT NUMBER(8) CHECK(CAMOUNT>=0),
    GNO NUMBER(1) REFERENCES GRADE(GNO)
);
SELECT * FROM CUSTOMER;

CREATE SEQUENCE CUSTOMER_CID_SEQ MAXVALUE 9999999 NOCACHE NOCYCLE;

-- 더미데이터 입력
INSERT INTO GRADE VALUES(1,'NORMAL',0,100000);
INSERT INTO GRADE VALUES(2,'BRONZE',100001,500000);
INSERT INTO GRADE VALUES(3,'SILVER',500001,1000000);
INSERT INTO GRADE VALUES(4,'GOLD',1000001,3000000);
INSERT INTO GRADE VALUES(5,'VIP',3000001,99999999);
SELECT * FROM GRADE;

INSERT INTO CUSTOMER VALUES(CUSTOMER_CID_SEQ.NEXTVAL,'010-9999-9999','홍길동',1000,0,1);
INSERT INTO CUSTOMER VALUES(CUSTOMER_CID_SEQ.NEXTVAL,'010-8888-8888','뉴진스',1000,200000,2);
INSERT INTO CUSTOMER VALUES(CUSTOMER_CID_SEQ.NEXTVAL,'010-7777-6666','아이브',1000,600000,3);
INSERT INTO CUSTOMER VALUES(CUSTOMER_CID_SEQ.NEXTVAL,'010-7777-5555','에스파',1000,1600000,4);
INSERT INTO CUSTOMER VALUES(CUSTOMER_CID_SEQ.NEXTVAL,'010-7777-4444','ITZY',1000,5600000,5);

SELECT * FROM CUSTOMER;

COMMIT;
-- JOIN
SELECT CID,CTEL,CNAME,CPOINT,CAMOUNT,C.GNO,GRADE,LAMOUNT,HIAMOUNT FROM CUSTOMER C, GRADE G   
    WHERE C.GNO = G.GNO;



SELECT CID FROM CUSTOMER C, GRADE G 
    WHERE C.GNO = G.GNO AND LAMOUNT >3000000;

SELECT CID, CNAME, CAMOUNT FROM CUSTOMER WHERE CID = (SELECT CID FROM CUSTOMER C, GRADE G 
    WHERE C.GNO = G.GNO AND LAMOUNT >3000000);


