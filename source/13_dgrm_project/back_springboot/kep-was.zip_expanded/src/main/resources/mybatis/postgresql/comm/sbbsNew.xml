<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kist.portal.common.sbbs.mapper.SbbsNewMapper">

    <resultMap type="com.kist.portal.common.sbbs.dto.SbbsNewDto" id="sbbsNewDto">
		<result property="boardId" column="boardId"/>
		<result property="title" column="title"/>
		<result property="content" column="content"/>
		<result property="createUser" column="createUser"/>
		<result property="createDate" column="createDate"/>
    </resultMap>

	<select id="selectSbbsNewList" parameterType="com.kist.portal.common.sbbs.dto.SbbsNewSearchDto" resultMap="sbbsNewDto">
        select  boardId           /* 게시판아이디 */
                , title           /* 제목 */
                , content         /* 내용 */
                , "createDate"    /* 등록일시 postgresql에서 Function명 중복으로 ""처리함. */
                , "createUser"    /* 등록자 postgresql에서 Function명 중복으로 ""처리함. */
        from    sample_board      /* 게시판테이블 */
		<if test='title != null and title != ""'>
        where   title like '%'||#{title}||'%'
		</if>
        order by
                "createDate" desc /* 등록일 내림차순 */
                , title asc       /* 제목 오름차순 */
    </select>

    <select id="selectSbbsNewDetail" parameterType="com.kist.portal.common.sbbs.dto.SbbsNewDto" resultMap="sbbsNewDto">
        select  boardId                   /* 게시판아이디2 */
                , title                   /* 제목 */
                , content                 /* 내용 */
                , "createDate"            /* 등록일시 postgresql에서 Function명 중복으로 ""처리함. */
                , "createUser"            /* 등록자 postgresql에서 Function명 중복으로 ""처리함. */
        from    sample_board              /* 게시판테이블 */
		<if test='boardId != null and boardId != ""'>
        where   boardId = #{boardId}      /* 게시판 아이디 */
		</if>

    </select>

    <insert id="insertSbbsNewBoard" parameterType="com.kist.portal.common.sbbs.dto.SbbsNewDto">
        insert into sample_board  (
          boardId         /* 게시판아이디2 (BBS + YYYYMMDD + 0000(seq)) */
          , title         /* 제목 */
          , content       /* 내용 */
          , "createDate"  /* 등록일 */
        )
        values(
          #{boardId}      /* 게시판 아이디 */
          , #{title}      /* 제목 */
          , #{content}    /* 내용 */
          , current_date  /* 현재날짜 */
        )
    </insert>

    <insert id="selectSbbsNewKey" parameterType="com.kist.portal.common.sbbs.dto.SbbsNewDto"
        useGeneratedKeys="true" keyProperty="boardId" keyColumn="boardId">
        <selectKey resultType="String" keyProperty="boardId" order="BEFORE">
            /* 게시판 아이디 생성 (BBS + YYYYMMDD + 0000(seq)) */
            select  'BBS'||TO_CHAR( NOW(), 'YYYYMMDD')||LPAD((substring(coalesce(max("boardid"), '000000000000000')::varchar, 12, 4)::numeric + 1)::text, 4, '0')
            from    sample_board
            where   substring("boardid"::varchar, 4, 8) = TO_CHAR(now(), 'YYYYMMDD')
        </selectKey>
        insert into sample_board (
          boardId         /* 게시판아이디2 (BBS + YYYYMMDD + 0000(seq)) */
          , title         /* 제목 */
          , content       /* 내용 */
          , "createDate"  /* 등록일 */
        )
        values(
          #{boardId}      /* 게시판 아이디 */
          , #{title}      /* 제목 */
          , #{content}    /* 내용 */
          , current_date  /* 현재날짜 */
        )
    </insert>

    <update id="updateSbbsNewBoard" parameterType="com.kist.portal.common.sbbs.dto.SbbsNewDto">
      update  sample_board
          set title = #{title},       /* 제목2 */
              content = #{content}    /* 내용 */
      where   boardId = #{boardId}    /* 게시판아이디 */
    </update>

    <delete id="deleteSbbsNewBoard" parameterType="com.kist.portal.common.sbbs.dto.SbbsNewDto">
      delete  from sample_board
        where boardId = #{boardId}    /* 게시판아이디2 */
    </delete>
	
</mapper>