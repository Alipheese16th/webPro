<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kist.portal.ch.rgltchk.mapper.RgltChkMapper">

	<!-- 규제검토요청목록 조회 -->
	<select id="selectRgltChkReqList" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkReqList  */
		select a.rglt_chk_no
		      ,b.mtrl_clsf_cd
		      ,b.chk_req_clsf_cd
		      ,b.mtrl_kind_cd
		      ,fn_get_cd('CO00000017', b.mtrl_clsf_cd, 'NM', #{SESS_LANG}) as mtrl_clsf_nm       
		      ,b.macl_cd
		      ,fn_get_cd('CH00000006', b.macl_cd, 'NM', #{SESS_LANG}) as macl_nm
		      ,a.wkpl_id 
		      ,fn_get_cd('CO00000006', a.wkpl_id, 'NM', #{SESS_LANG}) as wkpl_nm
		      ,b.mtrl_no
		      ,case when 'KO' = 'KO' then b.mtrl_ko_nm else b.mtrl_en_nm end as mtrl_nm 
		      ,b.mtrl_reg_da
		      ,b.mtrl_reg_usr_id
		      ,(select case when #{SESS_LANG} = 'KO' then u.usr_ko_nm 
				            when #{SESS_LANG} = 'EN' then u.usr_en_nm 
				            else u.usr_zh_nm 
				       end as usr_nm
			      from tb_co_user u
			     where u.usr_id = b.mtrl_reg_usr_id
			   ) as mtrl_reg_usr_nm
			  ,to_char(to_timestamp(b.mtrl_reg_da, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') as mtrl_reg_dt
			  ,case when a.rglt_chk_req_da is null or a.rglt_chk_req_da = '' then '' else to_char(to_timestamp(a.rglt_chk_req_da, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') end as rglt_chk_req_dt
		      ,a.rglt_chk_req_da         
		      ,case when a.rglt_chk_req_da is null or a.rglt_chk_req_da = '' then current_date - substring(a.crt_dt,1,8)::date else a.rglt_chk_req_da::date - substring(a.crt_dt,1,8)::date end as tat
		      ,a.rglt_chk_req_prog_stt_cd
		      ,fn_get_cd('CH00000012', a.rglt_chk_req_prog_stt_cd, 'NM', 'KO') as rglt_chk_req_prog_stt_nm
		      ,a.rglt_chk_req_usr_id
		      ,(select case when #{SESS_LANG} = 'KO' then u.usr_ko_nm 
				            when #{SESS_LANG} = 'EN' then u.usr_en_nm 
				            else u.usr_zh_nm 
				       end as usr_nm
			      from tb_co_user u
			     where u.usr_id = a.rglt_chk_req_usr_id
			   ) as rglt_chk_req_usr_nm
			  ,c.dept_cd
			  ,fn_get_dept(c.dept_cd) as dept_nm
              ,tcm.imp_yn
              ,tcm.sbms_tgt_yn 
		  from tb_ch_rglt_chk_req a
		  left join tb_ch_rglt_chk_mtrl b
		    on a.rglt_chk_no = b.rglt_chk_no 
		   and a.chk_req_clsf_cd = b.chk_req_clsf_cd
          left join tb_co_mtrl tcm
            on b.mtrl_no = tcm.mtrl_no
		  left join tb_co_user c
		    on c.usr_id = a.rglt_chk_req_usr_id
		 where a.del_yn = 'N'
		   and b.mtrl_kind_cd in ('2','4')
		 <if test='wkpl_id != null and wkpl_id != ""'>
		   and a.wkpl_id = #{wkpl_id}
		 </if>
		 <if test='mtrl_clsf_cd != null and mtrl_clsf_cd != ""'>
		   and b.mtrl_clsf_cd = #{mtrl_clsf_cd}
		 </if>
		 <if test='macl_cd != null and macl_cd != ""'>
		   and b.macl_cd = #{macl_cd}
		 </if>
		 <if test='mtrl_no != null and mtrl_no != ""'>
		   and b.mtrl_no like concat('%', rtrim(ltrim(#{mtrl_no})), '%')
		 </if>
		 <if test='mtrl_nm != null and mtrl_nm != ""'>
		   and b.mtrl_ko_nm like concat('%', rtrim(ltrim(#{mtrl_nm})), '%')
		 </if>
		 <if test='rglt_chk_req_prog_stt_cd != null and rglt_chk_req_prog_stt_cd != ""'>
		   and a.rglt_chk_req_prog_stt_cd = #{rglt_chk_req_prog_stt_cd}
		 </if>
		 <if test='rglt_chk_req_usr_id != null and rglt_chk_req_usr_id != ""'>
		   and a.rglt_chk_req_usr_id = #{rglt_chk_req_usr_id}
		 </if>
		 <if test='sDate != null and sDate != "" and eDate != null and eDate != ""'>
		   and (a.rglt_chk_req_da between replace(#{sDate},'-','') and replace(#{eDate},'-','') or a.rglt_chk_req_da is null or a.rglt_chk_req_da = '')
		 </if>
		 <if test='userno != null and userno != ""'>
		   and a.rglt_chk_req_usr_id = #{userno}
		 </if>
		 <if test='dept_nm != null and dept_nm != ""'>
		   and fn_get_dept(c.dept_cd) like concat('%', trim(#{dept_nm}), '%')
		 </if>
		 order by a.rglt_chk_no desc
	</select>
	
	<!-- 규제검토요청상세마스터 조회 -->
	<select id="selectRgltChkReqMstDtl" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkReqMstDtl */
		select a.rglt_chk_no
		      ,a.chk_req_clsf_cd
		      ,(select case when #{SESS_LANG} = 'KO' then u.usr_ko_nm 
				            when #{SESS_LANG} = 'EN' then u.usr_en_nm 
				            else u.usr_zh_nm 
				       end as usr_nm 
			      from tb_co_user u
			     where u.usr_id = a.rglt_chk_req_usr_id 
			   ) as rglt_chk_req_usr_nm
			  ,a.rglt_chk_req_usr_id
			  ,case when a.rglt_chk_req_da is null or a.rglt_chk_req_da = '' then '' else to_char(to_timestamp(a.rglt_chk_req_da, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') end as rglt_chk_req_dt
			  ,a.rglt_chk_req_da
			  ,b.mtrl_no 
			  ,case when #{SESS_LANG} = 'KO' then b.mtrl_ko_nm 
		            when #{SESS_LANG} = 'EN' then b.mtrl_en_nm 
		            else b.mtrl_zh_nm
		       end as mtrl_nm
		      ,b.mtrl_clsf_cd
		      ,fn_get_cd('CO00000017', b.mtrl_clsf_cd, 'nm', #{SESS_LANG}) as mtrl_clsf_nm
		      ,b.macl_cd
		      ,fn_get_cd('CH00000006', b.macl_cd, 'nm', #{SESS_LANG}) as macl_nm
		      ,b.mtrl_reg_usr_id
		      ,(select case when #{SESS_LANG} = 'KO' then u.usr_ko_nm 
				            when #{SESS_LANG} = 'EN' then u.usr_en_nm 
				            else u.usr_zh_nm 
				       end as usr_nm 
			      from tb_co_user u
			     where u.usr_id = b.mtrl_reg_usr_id 
			   ) as mtrl_reg_usr_nm
			  ,to_char(to_timestamp(b.mtrl_reg_da, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') as mtrl_reg_dt
			  ,b.mtrl_reg_da
			  ,a.wkpl_id 
			  ,coalesce(fn_get_cd('CO00000006', a.wkpl_id, 'nm', #{SESS_LANG}), '') as wkpl_nm
			  ,a.rglt_chk_req_prog_stt_cd
			  ,b.phase_cd
			  ,fn_get_cd('CH00000017', b.phase_cd, 'nm', #{SESS_LANG}) as phase_nm
			  ,coalesce(b.mtrl_puse_cd, '') as mtrl_puse_cd
			  ,fn_get_cd('CO00000018', b.mtrl_puse_cd, 'nm', #{SESS_LANG}) as mtrl_puse_nm
			  ,coalesce(b.mtrl_puse_cntn, '') as mtrl_puse_cntn
			  ,(select ARRAY_TO_STRING(ARRAY_AGG(fn_get_cd('CO00000007', s.plant_cd, 'nm', #{SESS_LANG})),', ')
			      from tb_co_mtrl_site s
			     where s.mtrl_no = b.mtrl_no 
			       and s.wkpl_id = a.wkpl_id 
			       and s.del_yn = 'N'
			     group by s.mtrl_no, s.wkpl_id 
			   ) as mtrl_plant
			  ,(select ARRAY_TO_STRING(ARRAY_AGG(fn_get_cd('CO00000006', s.wkpl_id, 'nm', #{SESS_LANG})),', ')
			      from tb_co_mtrl_site s
			     where s.mtrl_no = b.mtrl_no 
			       and s.del_yn = 'N'
			     group by s.mtrl_no
			   ) as mtrl_site
			  ,c.msds_ver
		      ,c.ko_atfl_no 
		      ,c.en_atfl_no 
		      ,c.imk_atfl_no
		      ,case when c.rev_da is null or c.rev_da = '' then null else to_char(to_timestamp(c.rev_da, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') end as rev_da
		      ,case when c.enact_da is null or c.enact_da = '' then null else to_char(to_timestamp(c.enact_da, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') end as enact_da
			  ,coalesce((select f.atfl_nm as name
		          from tb_co_atfl f
				 where f.atfl_no = c.ko_atfl_no limit 1
			   ),'') as ko_atfl_nm
			  ,coalesce((select f.atfl_nm as name
		          from tb_co_atfl f
				 where f.atfl_no = c.en_atfl_no limit 1
			   ),'') as en_atfl_nm
		      ,(select f.atfl_no || '-' || f.atfl_seq as key
		          from tb_co_atfl f
				 where f.atfl_no = c.ko_atfl_no limit 1
			   ) as ko_atfl_key
			  ,(select f.atfl_no || '-' || f.atfl_seq as key
		          from tb_co_atfl f
				 where f.atfl_no = c.en_atfl_no limit 1
			   ) as en_atfl_key
			  ,b.mtrl_kind_cd
  			  ,b.dngr_kind_cd
			  ,b.dngr_dtl_kind_cd
			  ,b.pchs_unit_cd
  			  ,case when b.pchs_unit_cd = '6' then b.pchs_unit_nm
            						else fn_get_cd('CH00000026',b.pchs_unit_cd,'NM',#{SESS_LANG}) 
			   end as pchs_unit_nm
			  ,RTRIM(RTRIM(b.pchs_unit_weght::text,'0'),'.') as pchs_unit_weght
			  ,coalesce(b.mtrl_fspt_infr_estn_yn, 'Y') as mtrl_fspt_infr_estn_yn
			  ,b.mtrl_fspt_vl
			  ,b.imk_item_no
			  ,e.vndr_nm
			  ,concat('http://', e.vndr_url) as vndr_url
              ,tcu.dept_cd
              ,fn_get_dept(tcu.dept_cd) as rglt_chk_req_dept_nm
              ,tcm.imp_yn 
              ,tcm.sbms_tgt_yn
              ,COALESCE(a.chmt_mtra_rgln_exmt_excl_num, '0') as chmt_mtra_rgln_exmt_excl_num
		  from tb_ch_rglt_chk_req a
          left join tb_co_user tcu 
            on a.rglt_chk_req_usr_id = tcu.usr_id
		      ,tb_ch_rglt_chk_mtrl b
		  left join (select a.mtrl_no 
					         ,max(a.vndr_no) as vndr_no
					         ,max(a.vndr_nm) as vndr_nm
					         ,max(b.vndr_url) as vndr_url
					   from tb_ch_mro_pchs_mtrl a
					       ,tb_co_vndr b
					   where a.vndr_no = b.vndr_no 
					   and a.vndr_no != 'Z' 
					   group by a.mtrl_no) e on b.mtrl_no = e.mtrl_no
          left join tb_co_mtrl tcm
            on b.mtrl_no = tcm.mtrl_no
		  left outer join tb_ch_rglt_chk_msds c
		    on b.rglt_chk_no = c.rglt_chk_no 
		   and b.chk_req_clsf_cd = c.chk_req_clsf_cd 
		   and b.mtrl_no = c.mtrl_no 
		   and c.del_yn = 'N'
		 where a.rglt_chk_no = b.rglt_chk_no 
		   and a.chk_req_clsf_cd = b.chk_req_clsf_cd
		   and a.del_yn = 'N'
		   and b.del_yn = 'N'
		   and b.rglt_chk_no = #{rglt_chk_no}
		   and b.chk_req_clsf_cd = #{chk_req_clsf_cd}
	</select>
	
	<!-- 규제검토요청 성분 정보 조회 -->
	<select id="selectRgltChkReqCnstList" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkReqCnstList */
		select a.comp_cnst_no
		      ,a.cas_no 
		      ,case when #{SESS_LANG} = 'KO' then a.comp_cnst_ko_nm 
		            when #{SESS_LANG} = 'EN' then a.comp_cnst_en_nm 
		            else a.comp_cnst_zh_nm 
		       end as comp_cnst_nm
		      ,a.comp_cnst_ratio 
		      ,a.rglt_chk_no 
		      ,a.chk_req_clsf_cd 
		      ,a.mtrl_no 
		  from tb_ch_rglt_chk_cnst a
		 where a.del_yn = 'N'
		   and a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
	</select>
	
	<!-- 규제검토요청 구성물질 정보 조회 -->
	<select id="selectRgltChkReqSbstList" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkReqSbstList */
		select a.rglt_chk_no 
		      ,a.chk_req_clsf_cd 
		      ,a.mtrl_no
		      ,a.sbst_no 
		      ,a.sbst_seq
		      ,a.sbst_type_cd
		      ,fn_get_cd('CH00000004', a.sbst_type_cd, 'nm', #{SESS_LANG}) as sbst_type_nm
		      ,a.cas_no
		      ,a.sbst_nm
		      ,RTRIM(RTRIM(a.sbst_rati::text,'0'),'.') as sbst_rati
		      ,a.sbst_note
		      ,(select kyin_yn from tb_ch_sbst tcs where a.sbst_no = tcs.sbst_no) as kyin_yn 
		  from tb_ch_rglt_chk_sbst a
		 where a.del_yn = 'N'
		   and a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		 order by a.sbst_seq
	</select>
	
	<!-- 규제검토요청 예상 규제 정보 조회 -->
	<select id="selectRgltChkReqRgltList" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkReqRgltList */
		select a.*
		   	  ,b.sbst_seq::text
		      ,b.lggosi_id
			  ,b.lgnoti_no
			  ,b.lgnoti_nm
			  ,b.lgnoti_da
			  ,b.lgnoti_law_nm
			  ,b.lgnoti_law_no
			  ,b.lgnoti_law_cntn
		      ,coalesce(b.rglt_crtr_rati,0)::text as rglt_crtr_rati 
		      ,b.rglt_crtr_cntn
		      ,b.rglt_sbst_note
 		  from( select a.rglt_chk_no 
				      ,a.chk_req_clsf_cd 
				      ,a.mtrl_no 
				      ,a.rglt_no 
				      ,a.law_cd 
				      ,fn_get_cd('CH00000003', a.law_cd, 'nm', #{SESS_LANG}) as law_nm
				      ,a.rglt_nm 
				      ,a.rglt_chk_doma_cd
				      ,a.rglt_type_cd
				      ,a.nat_cd
				      ,a.rglt_abbr
                      ,a.rglt_obj_yn as org_tgt_yn
                      ,case when a.rglt_obj_yn ='Y' then TRUE else FALSE end as tgt_yn
				      ,coalesce((select ARRAY_TO_STRING(ARRAY_AGG(c.cas_no),',')
				          from tb_ch_rglt_chk_rglt_sbst b
				              ,tb_ch_sbst c
				         where b.del_yn = 'N'
				           and c.del_yn = 'N'
				           and c.usg_yn = 'Y'
				           and b.sbst_no = c.sbst_no 
				           and b.rglt_chk_no = a.rglt_chk_no
				           and b.chk_req_clsf_cd = a.chk_req_clsf_cd
				           and b.mtrl_no = a.mtrl_no
				           and b.rglt_no = a.rglt_no
				         group by b.rglt_chk_no, b.chk_req_clsf_cd, b.mtrl_no, b.rglt_no
				       ),'') as cas_no
				      ,(select ARRAY_TO_STRING(ARRAY_AGG(c.sbst_no),',')
				          from tb_ch_rglt_chk_rglt_sbst b
				              ,tb_ch_sbst c
				         where b.del_yn = 'N'
				           and c.del_yn = 'N'
				           and c.usg_yn = 'Y'
				           and b.sbst_no = c.sbst_no 
				           and b.rglt_chk_no = a.rglt_chk_no
				           and b.chk_req_clsf_cd = a.chk_req_clsf_cd
				           and b.mtrl_no = a.mtrl_no
				           and b.rglt_no = a.rglt_no
				         group by b.rglt_chk_no, b.chk_req_clsf_cd, b.mtrl_no, b.rglt_no
				       ) as sbst_no
				      ,coalesce(a.rglt_note,'') as rglt_note
				      ,a.sort_seq
				  from tb_ch_rglt_chk_rglt a
				 where a.del_yn = 'N'
				   and a.rglt_chk_no = #{rglt_chk_no}
				   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
				 order by a.sort_seq
		 	  ) a
    		  left join tb_ch_rglt_chk_rglt_sbst b
				on  a.rglt_chk_no = b.rglt_chk_no
			   and a.chk_req_clsf_cd = b.chk_req_clsf_cd
			   and a.mtrl_no = b.mtrl_no
			   and a.rglt_no = b.rglt_no
			   and a.sbst_no  = b.sbst_no
 			 order by a.sort_seq
	</select>
	
	<!-- 규제검토요청 예상 규제 정보 조회(물질추가시) -->
	<select id="selectRgltChkReqRgltAddList" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkReqRgltAddList */
		select a.rglt_chk_no 
		      ,a.chk_req_clsf_cd 
		      ,a.mtrl_no 
		      ,a.rglt_no 
		      ,max(a.law_cd) as law_cd
		      ,max(a.law_nm) as law_nm
		      ,max(a.rglt_nm) as rglt_nm 
		      ,max(a.rglt_chk_doma_cd) as rglt_chk_doma_cd
		      ,max(a.rglt_type_cd) as rglt_type_cd  
		      ,max(a.nat_cd) as nat_cd
		      ,max(a.rglt_abbr) as rglt_abbr 
		      ,ARRAY_TO_STRING(ARRAY_AGG(a.cas_no),', ') as cas_no
		  from (select #{rglt_chk_no} as rglt_chk_no
				      ,#{chk_req_clsf_cd} as chk_req_clsf_cd
				      ,#{mtrl_no} as mtrl_no
				      ,a.rglt_no       
				      ,b.law_cd
				      ,fn_get_cd('CH00000003', b.law_cd, 'nm', #{SESS_LANG}) as law_nm
				      ,b.rglt_nm
				      ,b.nat_cd 
				      ,b.rglt_chk_doma_cd 
				      ,b.rglt_abbr 
				      ,b.rglt_type_cd
				      ,(select s.cas_no 
				          from tb_ch_sbst s
				         where s.sbst_no = a.sbst_no 
				           and s.del_yn = 'N'
				       ) as cas_no 
				      ,a.sbst_no
				  from tb_ch_rglt_sbst a
				      ,tb_ch_rglt b
				 where a.rglt_no = b.rglt_no
				   and a.del_yn = 'N'
				   and b.del_yn = 'N'
				   and b.usg_yn = 'Y'
				   and a.sbst_no in (${search_sbst_no})
			   ) a
		 group by a.rglt_chk_no, a.chk_req_clsf_cd, a.mtrl_no, a.rglt_no
	</select>
	
	<!-- 규제검토요청 경고표지 정보 조회 -->
	<select id="selectRgltChkReqGwsgnList" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkReqGwsgnList */
		select a.rglt_chk_no
		      ,a.chk_req_clsf_cd
		      ,a.mtrl_no 
		      ,a.sgw_cd
		      ,fn_get_cd('CH00000009', a.sgw_cd, 'nm', #{SESS_LANG}) as sgw_nm
		      ,coalesce(a.hars_cntn,'') as hars_cntn
              ,coalesce(a.prv_cntn,'') as prv_cntn
              ,coalesce(a.act_cntn,'') as act_cntn
              ,coalesce(a.str_cntn,'') as str_cntn
              ,coalesce(a.scr_cntn,'') as scr_cntn
		      ,a.vndr_no
		      ,a.vndr_kyin_yn
		      ,coalesce(a.vndr_nm, '') as vndr_nm 
		      ,coalesce(a.vndr_addr, '') as vndr_addr
		      ,coalesce(a.vndr_phon_no, '') as vndr_phon_no
		      ,coalesce(a.vndr_coreg_no, '') as vndr_coreg_no
		      ,a.vndr_type_cd
		      ,a.nat_cd
		      ,fn_get_cd('CO00000003', a.nat_cd, 'nm', #{SESS_LANG}) as nat_nm
		      ,a.vndr_rprs_nm
		  from tb_ch_rglt_chk_gwsgn a
		 where a.del_yn = 'N'
		   and a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
	</select>
	
	<!-- 규제검토요청 그림문자 정보 조회 -->
	<select id="selectRgltChkReqGwsgnPicList" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkReqGwsgnPicList */
		select a.rglt_chk_no 
		      ,a.chk_req_clsf_cd 
		      ,a.mtrl_no
		      ,a.picg_cd
		      ,a.print_yn
		  from tb_ch_rglt_chk_gwsgn_picg a
		 where a.del_yn = 'N'
		   and a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
	</select>
	
	<!-- 규제검토요청 자재정보 수정 -->
    <update id="updateRgltChkReqMtrl" parameterType="sqlMap">
        /* updateRgltChkReqMtrl */
        update tb_ch_rglt_chk_mtrl
		   set phase_cd = #{phase_cd}
		      ,mtrl_puse_cd = #{mtrl_puse_cd}
		      ,mtrl_puse_cntn = #{mtrl_puse_cntn}
		      ,macl_cd = #{macl_cd}
		 	<if test='mtrl_nm != null and mtrl_nm != ""'>
		      ,mtrl_ko_nm = #{mtrl_nm}
		      ,mtrl_en_nm = #{mtrl_nm}
		      ,mtrl_zh_nm = #{mtrl_nm}
		 	</if>
		      ,pchs_unit_cd = #{pchs_unit_cd}
		      ,pchs_req_unit_cd = #{pchs_unit_cd}
		      ,pchs_unit_nm = #{pchs_unit_nm}
		      ,pchs_req_unit_nm = #{pchs_unit_nm}
		      ,pchs_unit_weght = case when #{pchs_unit_weght} = '' then NULL
		                              when #{pchs_unit_weght} = NULL then NULL
		                              else #{pchs_unit_weght}::numeric
		                              end
		      ,pchs_req_unit_weght = case when #{pchs_unit_weght} = '' then NULL
		                              when #{pchs_unit_weght} = NULL then NULL
		                              else #{pchs_unit_weght}::numeric
		                              end
		      ,dngr_kind_cd = #{dngr_kind_cd}
		      ,dngr_dtl_kind_cd = #{dngr_dtl_kind_cd}
		      ,mtrl_fspt_infr_estn_yn = #{mtrl_fspt_infr_estn_yn}
		      ,mtrl_fspt_vl = case when #{mtrl_fspt_vl}::text = '' then NULL
		                           when #{mtrl_fspt_vl} = NULL then NULL
		                           else #{mtrl_fspt_vl}::numeric
		                       end
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no}
    </update>
    
    <!-- 규제검토 자재정보 수정 -->
    <update id="updateRgltChkMtrl" parameterType="sqlMap">
        /* updateRgltChkMtrl */
        update tb_ch_rglt_chk_mtrl
		   set phase_cd = #{phase_cd}
		      ,mtrl_puse_cd = #{mtrl_puse_cd}
		      ,mtrl_puse_cntn = #{mtrl_puse_cntn}
		      ,macl_cd = #{macl_cd}
		      ,pchs_unit_cd = #{pchs_unit_cd}
		      ,pchs_unit_nm = fn_get_cd('CH00000026', #{pchs_unit_cd}, 'NM', 'KO')
		      ,pchs_unit_weght = case when #{pchs_unit_weght} = '' then NULL
		                              when #{pchs_unit_weght} = NULL then NULL
		                              else #{pchs_unit_weght}::numeric
		                              end
		      ,dngr_kind_cd = #{dngr_kind_cd}
		      ,dngr_dtl_kind_cd = #{dngr_dtl_kind_cd}
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no}
    </update>
	
	<!-- 규제검토요청 구성물질 추가 -->
	<insert id="insertRgltChkReqSbst" parameterType="sqlMap">
        /* insertRgltChkReqSbst */
        insert into tb_ch_rglt_chk_sbst (
        	 rglt_chk_no
        	,chk_req_clsf_cd
        	,mtrl_no
        	,sbst_no
        	,sbst_seq
        	,sbst_type_cd
			,cas_no
			,sbst_nm
			,sbst_rati
			,sbst_note
			,del_yn
			,crt_usr_id
			,crt_dt
			,upt_usr_id
			,upt_dt
		) values (
	 		 #{rglt_chk_no}
	 		,#{chk_req_clsf_cd}
	 		,#{mtrl_no}
	 		,#{sbst_no}
			,(select coalesce(max(sbst_seq::integer),0) + 1 as key
			    from tb_ch_rglt_chk_sbst
			   where rglt_chk_no = #{rglt_chk_no}
			     and chk_req_clsf_cd = #{chk_req_clsf_cd}
			     and mtrl_no = #{mtrl_no}
			     and sbst_no = #{sbst_no}
			 )
			,#{sbst_type_cd}
			,#{cas_no}
			,#{sbst_nm}
			,#{sbst_rati}::numeric
			,#{sbst_note}
			,'N'
			,#{username}
			,to_char(now(), 'YYYYMMDDHH24MISS')
			,#{username}
			,to_char(now(), 'YYYYMMDDHH24MISS')
		)
    </insert>
    
    <!-- 규제검토요청 구성물질 존재 여부 체크 -->
    <select id="selectRgltChkReqSbstChk" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkReqSbstChk */
		select case when count(1) > 0 then 'Y' else 'N' end as up_yn 
		  from tb_ch_rglt_chk_sbst
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no}
		   and sbst_no = #{sbst_no}
		   and sbst_seq = #{sbst_seq}::integer
	</select>
    
    <!-- 규제검토요청 구성물질 수정 -->
    <update id="updateRgltChkReqSbst" parameterType="sqlMap">
        /* updateRgltChkReqSbst */
        update tb_ch_rglt_chk_sbst
		   set sbst_type_cd = #{sbst_type_cd}
		      ,cas_no = #{cas_no}
		      ,sbst_nm = #{sbst_nm}
		      ,sbst_rati = #{sbst_rati}::numeric
		      ,sbst_note = #{sbst_note}
		      ,del_yn = 'N'
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no}
		   and sbst_no = #{sbst_no}
		   and sbst_seq = #{sbst_seq}::integer
    </update>
    
    <!-- 규제검토요청 구성물질 삭제후추가 -->
    <update id="updateRgltChkReqSbstAdd" parameterType="sqlMap">
        /* updateRgltChkReqSbstAdd */
        update tb_ch_rglt_chk_sbst
		   set sbst_type_cd = #{sbst_type_cd}
		      ,cas_no = #{cas_no}
		      ,sbst_nm = #{sbst_nm}
		      ,sbst_rati = #{sbst_rati}::numeric
		      ,sbst_note = #{sbst_note}
		      ,del_yn = 'N'
		      ,crt_usr_id = #{username}
		      ,crt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no}
		   and sbst_no = #{sbst_no}
		   and sbst_seq = #{sbst_seq}::integer
    </update>
    
    <!-- 규제검토요청 구성물질 삭제 -->
    <update id="deleteRgltChkReqSbst" parameterType="sqlMap">
        /* deleteRgltChkReqSbst */
        update tb_ch_rglt_chk_sbst
		   set del_yn = 'Y'
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no}
		   and sbst_no = #{sbst_no}
		   and sbst_seq = #{sbst_seq}::integer
    </update>
    
    <!-- 규제검토요청 예상규제 삭제 -->
    <delete id="deleteRgltChkReqRglt" parameterType="sqlMap">
        /* deleteRgltChkReqRglt */
        delete 
          from tb_ch_rglt_chk_rglt
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토요청 예상규제 추가 -->
	<insert id="insertRgltChkReqRglt" parameterType="sqlMap">
        /* insertRgltChkReqRglt */
        insert into tb_ch_rglt_chk_rglt (
        	 rglt_chk_no
        	,chk_req_clsf_cd
        	,mtrl_no
        	,rglt_no
        	,rglt_chk_doma_cd
        	,nat_cd
			,rglt_type_cd
			,law_cd
			,rglt_nm
			,rglt_abbr
			,sort_seq
			,del_yn
			,crt_usr_id
			,crt_dt
			,upt_usr_id
			,upt_dt
			,rglt_obj_yn
		)
	 	select b.rglt_chk_no
		      ,b.chk_req_clsf_cd
		      ,b.mtrl_no
		      ,b.rglt_no
		      ,b.rglt_chk_doma_cd
		      ,b.nat_cd 
		      ,b.rglt_type_cd 
		      ,b.law_cd 
		      ,b.rglt_nm 
		      ,b.rglt_abbr
		      ,(ROW_NUMBER() OVER()) AS rnum
		      ,'N'
		      ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,'Y' as rglt_obj_yn
		  from (select distinct 
		               a.rglt_chk_no
				      ,a.chk_req_clsf_cd
				      ,a.mtrl_no
				      ,b.rglt_no 
				      ,c.rglt_chk_doma_cd
				      ,c.nat_cd 
				      ,c.rglt_type_cd 
				      ,c.law_cd 
				      ,c.rglt_nm 
				      ,c.rglt_abbr
				  from tb_ch_rglt_chk_sbst a
				      ,tb_ch_rglt_sbst b
				      ,tb_ch_rglt c
				 where a.del_yn = 'N'
				   and b.del_yn = 'N'
				   and c.del_yn = 'N'
				   and b.rglt_no = c.rglt_no 
				   and a.sbst_no = b.sbst_no 
				   and a.sbst_rati >= coalesce(b.rglt_crtr_rati,0) 
				   and a.rglt_chk_no = #{rglt_chk_no}
				   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
				   and a.mtrl_no = #{mtrl_no}
				   and case when #{macl_cd} = 'ICM' or #{macl_cd} = 'ICS' or #{macl_cd} = 'IHF' or #{macl_cd} = 'HIS' then c.law_cd in ('L03','L04')  -- 화장품 원료의 경우 산안법과 위험물관리법만 적용
		                    else 1=1
		               end
		    ) b
    </insert>
    
    <!-- 규제검토요청 규제물질 추가 -->
	<insert id="insertRgltChkReqRgltSbst" parameterType="sqlMap">
        /* insertRgltChkReqRgltSbst */
        insert into tb_ch_rglt_chk_rglt_sbst (
        	 rglt_chk_no
        	,chk_req_clsf_cd
        	,mtrl_no
        	,rglt_no
        	,sbst_no
        	,sbst_seq
        	,lggosi_id
			,lgnoti_no
			,lgnoti_nm
			,lgnoti_da
			,lgnoti_law_nm
			,lgnoti_law_no
			,lgnoti_law_cntn
        	,rglt_crtr_rati
			,rglt_crtr_cntn
			,rglt_sbst_note
			,del_yn
			,crt_usr_id
			,crt_dt
			,upt_usr_id
			,upt_dt
		)
	 	select a.rglt_chk_no
		      ,a.chk_req_clsf_cd
		      ,a.mtrl_no
		      ,a.rglt_no 
		      ,b.sbst_no 
		      ,b.sbst_seq
		      ,b.lggosi_id
			  ,b.lgnoti_no
			  ,b.lgnoti_nm
			  ,b.lgnoti_da
			  ,b.lgnoti_law_nm
			  ,b.lgnoti_law_no
			  ,b.lgnoti_law_cntn
		      ,b.rglt_crtr_rati 
		      ,b.rglt_crtr_cntn
		      ,b.rglt_sbst_note
		      ,'N'
		      ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
		  from tb_ch_rglt_chk_rglt a
		      ,(select b.rglt_chk_no
		              ,b.chk_req_clsf_cd 
		              ,b.mtrl_no 
		              ,b.sbst_no 
		              ,b.sbst_seq 
		              ,b.sbst_rati 
		              ,b.sbst_nm 
		              ,c.rglt_no
		              ,c.lggosi_id
					  ,c.lgnoti_no
					  ,c.lgnoti_nm
					  ,c.lgnoti_da
					  ,c.lgnoti_law_nm
					  ,c.lgnoti_law_no
					  ,c.lgnoti_law_cntn 
		              ,coalesce(c.rglt_crtr_rati,0) as rglt_crtr_rati 
		              ,c.rglt_crtr_cntn
		              ,c.rglt_sbst_note
		          from tb_ch_rglt_chk_sbst b
		              ,tb_ch_rglt_sbst c
		         where b.del_yn = 'N'
		           and c.del_yn = 'N'
		           and b.sbst_no = c.sbst_no 
		           and b.sbst_rati >= coalesce(c.rglt_crtr_rati,0)
		           and b.rglt_chk_no = #{rglt_chk_no}
				   and b.chk_req_clsf_cd = #{chk_req_clsf_cd}
				   and b.mtrl_no = #{mtrl_no}
		       ) b
		 where a.del_yn = 'N'
		   and a.rglt_chk_no = b.rglt_chk_no 
		   and a.chk_req_clsf_cd = b.chk_req_clsf_cd 
		   and a.mtrl_no = b.mtrl_no 
		   and a.rglt_no = b.rglt_no
		   and a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
    </insert>
    
    <!-- 규제검토요청 규제물질 삭제 -->
    <delete id="deleteRgltChkReqRgltSbst" parameterType="sqlMap">
        /* deleteRgltChkReqRgltSbst */
        delete 
          from tb_ch_rglt_chk_rglt_sbst
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토요청 저장 -->
    <update id="updateRgltChkReqDtl" parameterType="sqlMap">
        /* updateRgltChkReqDtl */
        update tb_ch_rglt_chk_req
		   set rglt_chk_req_usr_id = #{username}
		      ,rglt_chk_req_prog_stt_cd = '20'
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
    </update>
    
    <!-- 규제검토요청 요청 -->
    <update id="updateRgltChkReqDtlApr" parameterType="sqlMap">
        /* updateRgltChkReqDtlApr */
        update tb_ch_rglt_chk_req
		   set rglt_chk_req_da = to_char(now(), 'YYYYMMDD')
		      ,rglt_chk_req_usr_id = #{username}
		      ,rglt_chk_req_prog_stt_cd = '30'
		      ,rgln_exmt_excl_rq_rsn_cd = null
		      ,chmt_mtra_rgln_exmt_excl_txt = null
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
    </update>
    
    <!-- 규제검토요청 경고표지 저장 -->
    <insert id="insertRgltChkReqGwsgn" parameterType="sqlMap">
        /* insertRgltChkReqGwsgn */
        with upsert as (
		update tb_ch_rglt_chk_gwsgn
		   set sgw_cd           = #{sgw_cd}
		      ,hars_cntn        = #{hars_cntn}
		      ,prv_cntn         = #{prv_cntn}
		      ,act_cntn         = #{act_cntn}
		      ,str_cntn         = #{str_cntn}
		      ,scr_cntn         = #{scr_cntn}
		      ,vndr_no          = #{vndr_no}
		      ,vndr_kyin_yn     = #{vndr_kyin_yn}
		      ,vndr_nm          = #{vndr_nm}
		      ,vndr_type_cd     = #{vndr_type_cd}
		      ,nat_cd           = #{nat_cd}
		      ,vndr_addr        = #{vndr_addr}
		      ,vndr_phon_no     = #{vndr_phon_no}
		      ,vndr_rprs_nm     = #{vndr_rprs_nm}
		      ,vndr_coreg_no    = #{vndr_coreg_no}
		      ,upt_usr_id       = #{username}
		      ,upt_dt           = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no} RETURNING *
		)
		insert into tb_ch_rglt_chk_gwsgn (
			   rglt_chk_no
        	  ,chk_req_clsf_cd
        	  ,mtrl_no
        	  ,sgw_cd
        	  ,hars_cntn
        	  ,prv_cntn
			  ,act_cntn
			  ,str_cntn
			  ,scr_cntn
			  ,vndr_no
			  ,vndr_kyin_yn
			  ,vndr_nm
			  ,vndr_type_cd
			  ,nat_cd
			  ,vndr_addr
			  ,vndr_phon_no
			  ,vndr_rprs_nm
			  ,vndr_coreg_no
			  ,del_yn
			  ,crt_usr_id
			  ,crt_dt
			  ,upt_usr_id
			  ,upt_dt
		)
		select #{rglt_chk_no}
	 		  ,#{chk_req_clsf_cd}
	 		  ,#{mtrl_no}
	 		  ,#{sgw_cd}
			  ,#{hars_cntn}
			  ,#{prv_cntn}
			  ,#{act_cntn}
			  ,#{str_cntn}
			  ,#{scr_cntn}
			  ,#{vndr_no}
			  ,#{vndr_kyin_yn}
			  ,#{vndr_nm}
			  ,case when #{vndr_kyin_yn} = 'Y' then '2'
			        else #{vndr_type_cd} end as vndr_type_cd
			  ,#{nat_cd}
			  ,#{vndr_addr}
			  ,#{vndr_phon_no}
			  ,#{vndr_rprs_nm}
			  ,#{vndr_coreg_no}
			  ,'N'
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
	     where not exists (select * from upsert)
    </insert>
    
    <!-- 규제검토요청 그림문자 초기화 -->
    <update id="deleteRgltChkReqPic" parameterType="sqlMap">
        /* deleteRgltChkReqPic */
        update tb_ch_rglt_chk_gwsgn_picg
           set del_yn = 'Y'
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no}
    </update>
    
    <!-- 규제검토요청 그림문자 저장 -->
	<insert id="insertRgltChkReqPic" parameterType="sqlMap">
        /* insertRgltChkReqPic */
        with upsert as (
		update tb_ch_rglt_chk_gwsgn_picg
		   set del_yn = 'N'
		      ,upt_usr_id       = #{username}
		      ,upt_dt           = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and picg_cd = #{picg_cd}
		   and mtrl_no = #{mtrl_no} RETURNING *
		)
		insert into tb_ch_rglt_chk_gwsgn_picg (
			   rglt_chk_no
        	  ,chk_req_clsf_cd
        	  ,mtrl_no
        	  ,picg_cd
        	  ,print_yn
			  ,del_yn
			  ,crt_usr_id
			  ,crt_dt
			  ,upt_usr_id
			  ,upt_dt
		)
		select #{rglt_chk_no}
	 		  ,#{chk_req_clsf_cd}
	 		  ,#{mtrl_no}
	 		  ,#{picg_cd}
	 		  ,#{print_yn}
			  ,'N'
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
	     where not exists (select * from upsert)
    </insert>
    
    <!-- 규제검토 생성 -->
	<insert id="insertRgltChkInfo" parameterType="sqlMap">
        /* insertRgltChkInfo */
		insert into tb_ch_rglt_chk (
        	 rglt_chk_no
        	,chk_req_clsf_cd
        	,chk_type_cd
        	,wkpl_id
        	,rglt_chk_prog_stt_cd
        	,rglt_chk_req_da
        	,rglt_chk_req_usr_id
			,del_yn
			,crt_usr_id
			,crt_dt
			,upt_usr_id
			,upt_dt
		) values (
	 		 #{rglt_chk_no}
	 		,'2'
	 		,'1'
	 		,#{wkpl_id}
	 		,'30'
	 		,to_char(now(), 'YYYYMMDD')
	 		,#{rglt_chk_req_usr_id}
			,'N'
			,#{username}
			,to_char(now(), 'YYYYMMDDHH24MISS')
			,#{username}
			,to_char(now(), 'YYYYMMDDHH24MISS')
		)
    </insert>
    
    <!-- 규제검토 규제정보 생성 -->
	<insert id="insertRgltChkRgltList" parameterType="sqlMap">
        /* insertRgltChkRgltList */
        insert into tb_ch_rglt_chk_rglt (
        	   rglt_chk_no
        	  ,chk_req_clsf_cd
        	  ,mtrl_no
        	  ,rglt_no
        	  ,rglt_chk_doma_cd
        	  ,nat_cd
        	  ,rglt_type_cd
			  ,law_cd
			  ,rglt_nm
			  ,rglt_abbr
			  ,sort_seq
			  ,del_yn
			  ,crt_usr_id
			  ,crt_dt
			  ,upt_usr_id
			  ,upt_dt
			  ,rglt_obj_yn
		)
	 	select #{rglt_chk_no}
		      ,'2'
		      ,#{mtrl_no}
		      ,a.rglt_no 
		      ,a.rglt_chk_doma_cd
		      ,a.nat_cd
		      ,a.rglt_type_cd
		      ,a.law_cd
		      ,a.rglt_nm
		      ,a.rglt_abbr
		      ,a.sort_seq
		      ,'N'
		      ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,'N'
		  from tb_ch_rglt a
		 where a.usg_yn = 'Y' 
		   and a.del_yn = 'N'
		   and case when #{macl_cd} = 'ICM' or #{macl_cd} = 'ICS' or #{macl_cd} = 'IHF' or #{macl_cd} = 'HIS' then a.law_cd in ('L03','L04')  -- 화장품 원료의 경우 산안법과 위험물관리법만 적용
                    else 1=1
               end
    </insert>
    
    <!-- 규제검토 규제물질 추가(검토요청시) -->
	<insert id="insertRgltChkRgltSbstF" parameterType="sqlMap">
        /* insertRgltChkRgltSbstF */
        insert into tb_ch_rglt_chk_rglt_sbst (
        	 rglt_chk_no
        	,chk_req_clsf_cd
        	,mtrl_no
        	,rglt_no
        	,sbst_no
        	,sbst_seq
        	,lggosi_id
			,lgnoti_no
			,lgnoti_nm
			,lgnoti_da
			,lgnoti_law_nm
			,lgnoti_law_no
			,lgnoti_law_cntn
        	,rglt_crtr_rati
			,rglt_crtr_cntn
			,rglt_sbst_note
			,del_yn
			,crt_usr_id
			,crt_dt
			,upt_usr_id
			,upt_dt
		)
	 	select a.rglt_chk_no
		      ,'2'
		      ,a.mtrl_no
		      ,a.rglt_no 
		      ,b.sbst_no 
		      ,b.sbst_seq
		      ,b.lggosi_id
			  ,b.lgnoti_no
			  ,b.lgnoti_nm
			  ,b.lgnoti_da
			  ,b.lgnoti_law_nm
			  ,b.lgnoti_law_no
			  ,b.lgnoti_law_cntn
		      ,b.rglt_crtr_rati 
		      ,b.rglt_crtr_cntn
		      ,b.rglt_sbst_note
		      ,'N'
		      ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
		  from tb_ch_rglt_chk_rglt a
		      ,(select b.rglt_chk_no
		              ,b.chk_req_clsf_cd 
		              ,b.mtrl_no 
		              ,b.sbst_no 
		              ,b.sbst_seq 
		              ,b.sbst_rati 
		              ,b.sbst_nm 
		              ,c.rglt_no 
		              ,c.lggosi_id
					  ,c.lgnoti_no
					  ,c.lgnoti_nm
					  ,c.lgnoti_da
					  ,c.lgnoti_law_nm
					  ,c.lgnoti_law_no
					  ,c.lgnoti_law_cntn 		              
		              ,coalesce(c.rglt_crtr_rati,0) as rglt_crtr_rati 
		              ,c.rglt_crtr_cntn
		              ,c.rglt_sbst_note
		          from tb_ch_rglt_chk_sbst b
		              ,tb_ch_rglt_sbst c
		         where b.del_yn = 'N'
		           and c.del_yn = 'N'
		           and b.sbst_no = c.sbst_no 
		           and b.sbst_rati >= coalesce(c.rglt_crtr_rati,0)
		           and b.rglt_chk_no = #{rglt_chk_no}
				   and b.chk_req_clsf_cd = #{chk_req_clsf_cd}
				   and b.mtrl_no = #{mtrl_no}
		       ) b
		 where a.del_yn = 'N'
		   and a.rglt_chk_no = b.rglt_chk_no 
		   and a.chk_req_clsf_cd = b.chk_req_clsf_cd 
		   and a.mtrl_no = b.mtrl_no 
		   and a.rglt_no = b.rglt_no
		   and a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
    </insert>
    
    <!-- 규제검토 그림문자 저장 -->
	<insert id="insertRgltChkPicF" parameterType="sqlMap">
        /* insertRgltChkPicF */
        with upsert as (
		update tb_ch_rglt_chk_gwsgn_picg
		   set del_yn = 'N'
		      ,upt_usr_id       = #{username}
		      ,upt_dt           = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = '2'
		   and picg_cd = #{picg_cd}
		   and mtrl_no = #{mtrl_no} RETURNING *
		)
		insert into tb_ch_rglt_chk_gwsgn_picg (
			   rglt_chk_no
        	  ,chk_req_clsf_cd
        	  ,mtrl_no
        	  ,picg_cd
        	  ,print_yn
			  ,del_yn
			  ,crt_usr_id
			  ,crt_dt
			  ,upt_usr_id
			  ,upt_dt
		)
		select #{rglt_chk_no}
	 		  ,'2'
	 		  ,#{mtrl_no}
	 		  ,#{picg_cd}
	 		  ,#{print_yn}
			  ,'N'
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
	     where not exists (select * from upsert)
    </insert>
    
    <!-- 규제검토 경고표지 저장 -->
    <insert id="insertRgltChkGwsgnF" parameterType="sqlMap">
        /* insertRgltChkGwsgnF */
        with upsert as (
		update tb_ch_rglt_chk_gwsgn
		   set sgw_cd           = #{sgw_cd}
		      ,hars_cntn        = #{hars_cntn}
		      ,prv_cntn         = #{prv_cntn}
		      ,act_cntn         = #{act_cntn}
		      ,str_cntn         = #{str_cntn}
		      ,scr_cntn         = #{scr_cntn}
		      ,vndr_no          = #{vndr_no}
		      ,vndr_kyin_yn     = #{vndr_kyin_yn}
		      ,vndr_nm          = #{vndr_nm}
		      ,vndr_type_cd     = #{vndr_type_cd}
		      ,nat_cd           = #{nat_cd}
		      ,vndr_addr        = #{vndr_addr}
		      ,vndr_phon_no     = #{vndr_phon_no}
		      ,vndr_rprs_nm     = #{vndr_rprs_nm}
		      ,vndr_coreg_no    = #{vndr_coreg_no}
		      ,upt_usr_id       = #{username}
		      ,upt_dt           = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = '2'
		   and mtrl_no = #{mtrl_no} RETURNING *
		)
		insert into tb_ch_rglt_chk_gwsgn (
			   rglt_chk_no
        	  ,chk_req_clsf_cd
        	  ,mtrl_no
        	  ,sgw_cd
        	  ,hars_cntn
        	  ,prv_cntn
			  ,act_cntn
			  ,str_cntn
			  ,scr_cntn
			  ,vndr_no
			  ,vndr_kyin_yn
			  ,vndr_nm
			  ,vndr_type_cd
			  ,nat_cd
			  ,vndr_addr
			  ,vndr_phon_no
			  ,vndr_rprs_nm
			  ,vndr_coreg_no
			  ,del_yn
			  ,crt_usr_id
			  ,crt_dt
			  ,upt_usr_id
			  ,upt_dt
		)
		select #{rglt_chk_no}
	 		  ,'2'
	 		  ,#{mtrl_no}
	 		  ,#{sgw_cd}
			  ,#{hars_cntn}
			  ,#{prv_cntn}
			  ,#{act_cntn}
			  ,#{str_cntn}
			  ,#{scr_cntn}
			  ,#{vndr_no}
			  ,#{vndr_kyin_yn}
			  ,#{vndr_nm}
			  ,case when #{vndr_kyin_yn} = 'Y' then '2'
			        else #{vndr_type_cd} end as vndr_type_cd
			  ,#{nat_cd}
			  ,#{vndr_addr}
			  ,#{vndr_phon_no}
			  ,#{vndr_rprs_nm}
			  ,#{vndr_coreg_no}
			  ,'N'
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
	     where not exists (select * from upsert)
    </insert>
    
    <!-- 규제검토 구성물질 추가 -->
	<insert id="insertRgltChkSbstF" parameterType="sqlMap">
        /* insertRgltChkSbstF */
        insert into tb_ch_rglt_chk_sbst (
        	   rglt_chk_no
        	  ,chk_req_clsf_cd
        	  ,mtrl_no
        	  ,sbst_no
        	  ,sbst_seq
        	  ,sbst_type_cd
			  ,cas_no
			  ,sbst_nm
			  ,sbst_rati
			  ,sbst_note
			  ,del_yn
			  ,crt_usr_id
			  ,crt_dt
			  ,upt_usr_id
			  ,upt_dt
		)
		select a.rglt_chk_no
		      ,'2'
		      ,a.mtrl_no
		      ,a.sbst_no 
		      ,a.sbst_seq 
		      ,a.sbst_type_cd
		      ,a.cas_no 
		      ,a.sbst_nm
		      ,a.sbst_rati
		      ,a.sbst_note
		      ,'N'
		      ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
		  from tb_ch_rglt_chk_sbst a
		 where a.del_yn = 'N'
		   and a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
    </insert>
    
    <!-- 규제검토 자재 추가 -->
	<insert id="insertRgltChkMtrlF" parameterType="sqlMap">
        /* insertRgltChkMtrlF */
        insert into tb_ch_rglt_chk_mtrl (
        	   rglt_chk_no
        	  ,chk_req_clsf_cd
        	  ,mtrl_no
        	  ,mtrl_clsf_cd
        	  ,mtrl_kind_cd
        	  ,mtrl_type_cd
			  ,mtrl_grp_cd
			  ,macl_cd
			  ,mtrl_ko_nm
			  ,mtrl_en_nm
			  ,mtrl_zh_nm
			  ,mtrl_reg_usr_id
			  ,mtrl_reg_da
			  ,oem_odm_yn
			  ,qdrg_yn
			  ,imk_item_no
			  ,imk_item_ctgr_cd
			  ,imk_item_ctgr_nm
			  ,msds_rev_no
			  ,mtrl_puse_cd
			  ,mtrl_puse_cntn
			  ,pchs_unit_cd
			  ,pchs_req_unit_cd
			  ,pchs_unit_nm
			  ,pchs_req_unit_nm
			  ,pchs_unit_weght
			  ,pchs_req_unit_weght
			  ,pchs_unit_nweght_qty
			  ,mtrl_fspt_infr_estn_yn
			  ,mtrl_fspt_vl
			  ,phase_cd
			  ,impt_yn
  			  ,dngr_kind_cd
			  ,dngr_dtl_kind_cd
			  ,usg_yn
			  ,del_yn
			  ,crt_usr_id
			  ,crt_dt
			  ,upt_usr_id
			  ,upt_dt
		)
		select a.rglt_chk_no
		      ,'2'
		      ,a.mtrl_no
		      ,a.mtrl_clsf_cd 
		      ,a.mtrl_kind_cd 
		      ,a.mtrl_type_cd
		      ,a.mtrl_grp_cd 
		      ,a.macl_cd
		      ,a.mtrl_ko_nm
		      ,a.mtrl_en_nm
		      ,a.mtrl_zh_nm
		      ,a.mtrl_reg_usr_id
		      ,a.mtrl_reg_da
		      ,a.oem_odm_yn
		      ,a.qdrg_yn
		      ,a.imk_item_no
		      ,a.imk_item_ctgr_cd
		      ,a.imk_item_ctgr_nm
		      ,a.msds_rev_no
		      ,a.mtrl_puse_cd
		      ,a.mtrl_puse_cntn
		      ,a.pchs_unit_cd
		      ,a.pchs_unit_cd
   	      	  ,case when a.pchs_unit_cd = '6' then a.pchs_unit_nm
			            					  else fn_get_cd('CH00000026',a.pchs_unit_cd,'NM','KO') 
			   end as pchs_unit_nm
			  ,case when a.pchs_unit_cd = '6' then a.pchs_unit_nm
			            					  else fn_get_cd('CH00000026',a.pchs_unit_cd,'NM','KO') 
			   end as pchs_unit_nm
			  ,a.pchs_unit_weght
			  ,a.pchs_unit_weght
		      ,a.pchs_unit_nweght_qty
			  ,a.mtrl_fspt_infr_estn_yn
			  ,a.mtrl_fspt_vl
		      ,a.phase_cd
		      ,a.impt_yn
   			  ,a.dngr_kind_cd
			  ,a.dngr_dtl_kind_cd
		      ,a.usg_yn
		      ,'N'
		      ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
		  from tb_ch_rglt_chk_mtrl a
		 where a.del_yn = 'N'
		   and a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
    </insert>
    
    <!-- 규제검토목록 조회 -->
	<select id="selectRgltChkList" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkList */
		select a.rglt_chk_no
		      ,b.mtrl_clsf_cd
		      ,b.chk_req_clsf_cd
		      ,b.mtrl_kind_cd
		      ,fn_get_cd('CO00000017', b.mtrl_clsf_cd, 'NM', #{SESS_LANG}) as mtrl_clsf_nm       
		      ,b.macl_cd
		      ,fn_get_cd('CH00000006', b.macl_cd, 'NM', #{SESS_LANG}) as macl_nm
		      ,a.wkpl_id 
		      ,fn_get_cd('CO00000006', a.wkpl_id, 'NM', #{SESS_LANG}) as wkpl_nm
		      ,b.mtrl_no
		      ,case when 'KO' = 'KO' then b.mtrl_ko_nm else b.mtrl_en_nm end as mtrl_nm 
		      ,b.mtrl_reg_da
		      ,b.mtrl_reg_usr_id
		      ,fn_get_user(b.mtrl_reg_usr_id, 'NM', #{SESS_LANG}) as mtrl_reg_usr_nm
			  ,to_char(to_timestamp(b.mtrl_reg_da, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') as mtrl_reg_dt
		      ,a.rglt_chk_prog_stt_cd
		      ,fn_get_cd('CH00000013', a.rglt_chk_prog_stt_cd, 'NM', #{SESS_LANG}) as rglt_chk_prog_stt_nm
		      ,case when r.rglt_chk_dt is null or length(r.rglt_chk_dt) <![CDATA[<]]> 1 then to_date(to_char(now(),'YYYYMMDD'),'YYYYMMDD') - to_date(a.rglt_chk_req_da ,'YYYYMMDD')
                    else to_date(substring(r.rglt_chk_dt,1,8),'YYYYMMDD') - to_date(a.rglt_chk_req_da ,'YYYYMMDD')
               end as tat
		      ,fn_get_time(r.rglt_chk_dt, #{SESS_TIME_ZONE},'DA', '-') as rglt_chk_dt
		      ,fn_get_user(r.rglt_chk_usr_id, 'NM', #{SESS_LANG}) as rglt_chk_usr_nm
		      ,a.rglt_chk_req_usr_id
		      ,fn_get_user(a.rglt_chk_req_usr_id, 'NM', #{SESS_LANG}) as rglt_chk_req_usr_nm
		      ,case when a.rglt_chk_req_da is null or a.rglt_chk_req_da = '' then '' 
		            else to_char(to_date(a.rglt_chk_req_da, 'YYYYMMDD'), 'YYYY-MM-DD')
		       end as rglt_chk_req_dt
			  ,d.dept_cd
			  ,fn_get_dept(d.dept_cd) as dept_nm
              ,tcm.imp_yn
              ,tcm.sbms_tgt_yn
              ,(select rgln_exmt_excl_rq_rsn_cd
              		  from tb_ch_rglt_chk_req tcr
                    where a.rglt_chk_no = tcr.rglt_chk_no) as rgln_exmt_excl_rq_rsn_cd 
		  from tb_ch_rglt_chk a
		  left join tb_ch_rglt_chk_mtrl b on a.rglt_chk_no = b.rglt_chk_no and a.chk_req_clsf_cd = b.chk_req_clsf_cd
          left join tb_co_mtrl tcm
            on b.mtrl_no = tcm.mtrl_no
		  left outer join tb_ch_rglt_chk_req c on c.rglt_chk_no = a.rglt_chk_no
          left outer join tb_ch_rglt_chk_doma_rslt r on r.rglt_chk_no = a.rglt_chk_no and r.chk_req_clsf_cd  = a.chk_req_clsf_cd and r.rglt_chk_doma_cd = 'Z'
		  left join tb_co_user d on d.usr_id = a.rglt_chk_req_usr_id
		 where a.del_yn = 'N'
		   and a.chk_req_clsf_cd = '2'
		 <if test='wkpl_id != null and wkpl_id != ""'>
		   and a.wkpl_id = #{wkpl_id}
		 </if>
		 <if test='mtrl_clsf_cd != null and mtrl_clsf_cd != ""'>
		   and b.mtrl_clsf_cd = #{mtrl_clsf_cd}
		 </if>
		 <if test='macl_cd != null and macl_cd != ""'>
		   and b.macl_cd = #{macl_cd}
		 </if>
		 <if test='mtrl_no != null and mtrl_no != ""'>
		   and b.mtrl_no like concat('%', rtrim(ltrim(#{mtrl_no})), '%')
		 </if>
		 <if test='mtrl_nm != null and mtrl_nm != ""'>
		   and b.mtrl_ko_nm like concat('%', rtrim(ltrim(#{mtrl_nm})), '%')
		 </if>
		 <if test='rglt_chk_prog_stt_cd != null and rglt_chk_prog_stt_cd != ""'>
		   and a.rglt_chk_prog_stt_cd = #{rglt_chk_prog_stt_cd}
		 </if>
		 <if test='rglt_chk_req_usr_id != null and rglt_chk_req_usr_id != ""'>
		   and a.rglt_chk_req_usr_id = #{rglt_chk_req_usr_id}
		 </if>
		 <if test='sDate != null and sDate != "" and eDate != null and eDate != ""'>
		   and (a.rglt_chk_req_da between replace(#{sDate},'-','') and replace(#{eDate},'-','') or a.rglt_chk_req_da is null or a.rglt_chk_req_da = '') 
		 </if>
		 <if test='dept_nm != null and dept_nm != ""'>
		   and fn_get_dept(d.dept_cd) like concat('%', trim(#{dept_nm}), '%')
		 </if>
		 order by a.rglt_chk_req_da desc, a.rglt_chk_no desc
	</select>
	
	<!-- 규제검토상세마스터 조회 -->
	<select id="selectRgltChkMstDtl" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkMstDtl */
		select a.rglt_chk_no 
		      ,a.chk_req_clsf_cd 
		      ,a.wkpl_id 
		      ,coalesce(fn_get_cd('CO00000006', a.wkpl_id, 'nm', #{SESS_LANG}), '') as wkpl_nm
		      ,a.rglt_chk_prog_stt_cd 
		      ,a.aprv_no 
		      ,a.aprv_crt_dt 
		      ,a.aprv_cmpt_dt 
		      ,b.rglt_chk_req_da 
		      ,case when a.rglt_chk_req_da is null or a.rglt_chk_req_da = '' then '' else to_char(to_timestamp(a.rglt_chk_req_da, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') end as rglt_chk_req_dt
		      ,a.rglt_chk_req_usr_id
		      ,(select case when #{SESS_LANG} = 'KO' then tcd.dept_ko_nm
				            when #{SESS_LANG} = 'EN' then tcd.dept_en_nm
				       end
		          from tb_co_user tcu 
		              ,tb_co_dept tcd 
		         where tcu.dept_cd = tcd.dept_cd 
		           and tcu.usr_id = a.rglt_chk_req_usr_id
		       ) as rglt_chk_req_dept_nm
		      ,fn_get_user(a.rglt_chk_req_usr_id, 'NM', #{SESS_LANG}) as rglt_chk_req_usr_nm
			  ,c.mtrl_no 
			  ,case when #{SESS_LANG} = 'KO' then c.mtrl_ko_nm 
		            when #{SESS_LANG} = 'EN' then c.mtrl_en_nm 
		            else c.mtrl_zh_nm
		       end as mtrl_nm
		      ,c.mtrl_clsf_cd 
		      ,fn_get_cd('CO00000017', c.mtrl_clsf_cd, 'nm', #{SESS_LANG}) as mtrl_clsf_nm
		      ,c.macl_cd 
		      ,fn_get_cd('CH00000006', c.macl_cd, 'nm', #{SESS_LANG}) as macl_nm
		      ,c.mtrl_reg_usr_id
		      ,(select case when #{SESS_LANG} = 'KO' then u.usr_ko_nm 
				            when #{SESS_LANG} = 'EN' then u.usr_en_nm 
				            else u.usr_zh_nm 
				       end as usr_nm 
			      from tb_co_user u
			     where u.usr_id = c.mtrl_reg_usr_id 
			   ) as mtrl_reg_usr_nm
			  ,to_char(to_timestamp(c.mtrl_reg_da, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') as mtrl_reg_dt
			  ,c.mtrl_reg_da
			  ,c.phase_cd
			  ,fn_get_cd('CH00000017', c.phase_cd, 'nm', #{SESS_LANG}) as phase_nm
			  ,c.mtrl_puse_cd
			  ,fn_get_cd('CO00000018', c.mtrl_puse_cd, 'nm', #{SESS_LANG}) as mtrl_puse_nm
			  ,coalesce(c.mtrl_puse_cntn, '') as mtrl_puse_cntn
			  ,(select ARRAY_TO_STRING(ARRAY_AGG(fn_get_cd('CO00000007', s.plant_cd, 'nm', #{SESS_LANG})),', ')
			      from tb_co_mtrl_site s
			     where s.mtrl_no = c.mtrl_no 
			       and s.wkpl_id = a.wkpl_id 
			       and s.del_yn = 'N'
			     group by s.mtrl_no, s.wkpl_id 
			   ) as mtrl_plant
			  ,(select ARRAY_TO_STRING(ARRAY_AGG(fn_get_cd('CO00000006', s.wkpl_id, 'nm', #{SESS_LANG})),', ')
			      from tb_co_mtrl_site s
			     where s.mtrl_no = c.mtrl_no 
			       and s.del_yn = 'N'
			     group by s.mtrl_no
			   ) as mtrl_site
			  ,coalesce((select case when #{SESS_LANG} = 'KO' then u.usr_ko_nm 
				            when #{SESS_LANG} = 'EN' then u.usr_en_nm 
				            else u.usr_zh_nm 
				       end as usr_nm
			      from tb_ch_rglt_chk_doma_rslt r
			          ,tb_co_user u
			     where r.rglt_chk_no = a.rglt_chk_no 
			       and r.chk_req_clsf_cd = a.chk_req_clsf_cd 
			       and r.rglt_chk_usr_id = u.usr_id 
			       and r.rglt_chk_doma_cd = 'Z'
			   ),'') as rglt_chk_usr_nm
			  ,(select r.rglt_chk_usr_id
			      from tb_ch_rglt_chk_doma_rslt r
			     where r.rglt_chk_no = a.rglt_chk_no 
			       and r.chk_req_clsf_cd = a.chk_req_clsf_cd 
			       and r.rglt_chk_doma_cd = 'Z'
			   ) as rglt_chk_usr_id
			  ,coalesce((select case when r.rglt_chk_dt = '' or r.rglt_chk_dt is null then null else fn_get_time(r.rglt_chk_dt, #{SESS_TIME_ZONE},'DA', '-') end as mtrl_reg_dt
			      from tb_ch_rglt_chk_doma_rslt r
			     where r.rglt_chk_no = a.rglt_chk_no 
			       and r.chk_req_clsf_cd = a.chk_req_clsf_cd 
			       and r.rglt_chk_doma_cd = 'Z'
			   ),'') as rglt_chk_dt
			  ,d.msds_ver
		      ,d.ko_atfl_no 
		      ,coalesce(d.en_atfl_no, null) as en_atfl_no
		      ,case when d.rev_da is null or d.rev_da = '' then null else to_char(to_timestamp(d.rev_da, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') end as rev_da
		      ,case when d.enact_da is null or d.enact_da = '' then null else to_char(to_timestamp(d.enact_da, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') end as enact_da
			  ,coalesce((select f.atfl_nm as name
		          from tb_co_atfl f
				 where f.atfl_no = d.ko_atfl_no limit 1
			   ),'') as ko_atfl_nm
			  ,coalesce((select f.atfl_nm as name
		          from tb_co_atfl f
				 where f.atfl_no = d.en_atfl_no limit 1
			   ),'') as en_atfl_nm
		      ,(select f.atfl_no || '-' || f.atfl_seq as key
		          from tb_co_atfl f
				 where f.atfl_no = d.ko_atfl_no limit 1
			   ) as ko_atfl_key
			  ,(select f.atfl_no || '-' || f.atfl_seq as key
		          from tb_co_atfl f
				 where f.atfl_no = d.en_atfl_no limit 1
			   ) as en_atfl_key
			  ,c.mtrl_kind_cd
			  ,coalesce(c.dngr_kind_cd, '') as dngr_kind_cd
			  ,coalesce(c.dngr_dtl_kind_cd, '') as dngr_dtl_kind_cd
		      ,fn_get_cd('CH00000027', c.dngr_kind_cd, 'nm', #{SESS_LANG}) as dngr_kind_nm
			  ,fn_get_cd('CH00000028', c.dngr_dtl_kind_cd, 'nm', #{SESS_LANG}) as dngr_dtl_kind_nm
  		  	  ,c.pchs_unit_cd
			  ,case when c.pchs_unit_cd = '6' then c.pchs_unit_nm
					            			  else fn_get_cd('CH00000026', c.pchs_unit_cd,'NM',#{SESS_LANG}) 
			   end as pchs_unit_nm
			  ,RTRIM(RTRIM(c.pchs_unit_weght::text,'0'),'.') as pchs_unit_weght
			  ,c.mtrl_fspt_infr_estn_yn
			  ,c.mtrl_fspt_vl
			  ,c.imk_item_no
			  ,e.vndr_nm
			  ,concat('http://', e.vndr_url) as vndr_url
              ,tcm.imp_yn
              ,tcm.sbms_tgt_yn
              ,(select rgln_exmt_excl_rq_rsn_cd
              		  from tb_ch_rglt_chk_req tcr
                    where a.rglt_chk_no = tcr.rglt_chk_no) as rgln_exmt_excl_rq_rsn_cd 
              ,(select chmt_mtra_rgln_exmt_excl_txt
                      from tb_ch_rglt_chk_req tcr
                    where a.rglt_chk_no = tcr.rglt_chk_no) as chmt_mtra_rgln_exmt_excl_txt 
		  from tb_ch_rglt_chk a
		  join tb_ch_rglt_chk_mtrl c on a.rglt_chk_no = c.rglt_chk_no and a.chk_req_clsf_cd = c.chk_req_clsf_cd
		  join tb_co_mtrl tcm on c.mtrl_no = tcm.mtrl_no
		  left join (select a.mtrl_no 
					         ,max(a.vndr_no) as vndr_no
					         ,max(a.vndr_nm) as vndr_nm
					         ,max(b.vndr_url) as vndr_url
					   from tb_ch_mro_pchs_mtrl a
					       ,tb_co_vndr b
					   where a.vndr_no = b.vndr_no 
					   and a.vndr_no != 'Z' 
					   group by a.mtrl_no) e on c.mtrl_no = e.mtrl_no
		  left join tb_ch_rglt_chk_req b on a.rglt_chk_no = b.rglt_chk_no
		  left outer join tb_ch_rglt_chk_msds d on c.rglt_chk_no = d.rglt_chk_no 
		   and c.chk_req_clsf_cd = d.chk_req_clsf_cd 
		   and c.mtrl_no = d.mtrl_no 
		   and d.del_yn = 'N'
		 where a.del_yn = 'N'
		   and c.del_yn = 'N'
		   and c.rglt_chk_no = #{rglt_chk_no}
		   and c.chk_req_clsf_cd = #{chk_req_clsf_cd}
	</select>
	
	<!-- 규제검토 검토 정보 조회 -->
	<select id="selectRgltChkRsltInfo" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkRsltInfo */
		select a.rglt_chk_no 
		      ,a.chk_req_clsf_cd 
		      ,a.rglt_chk_doma_cd 
		      ,a.rglt_chk_usr_id 
		      ,(select case when #{SESS_LANG} = 'KO' then u.usr_ko_nm 
				            when #{SESS_LANG} = 'EN' then u.usr_en_nm 
				            else u.usr_zh_nm 
				       end as usr_nm 
			      from tb_co_user u
			     where u.usr_id = a.rglt_chk_usr_id 
			   ) as rglt_chk_usr_nm
			  ,coalesce(fn_get_time(a.rglt_chk_dt, #{SESS_TIME_ZONE},'DT', '-'),'') as rglt_chk_dt
			  ,coalesce(a.rglt_chk_rslt_cntn,'') as rglt_chk_rslt_cntn
			  ,a.rglt_chk_mtrl_usg_yn
			  ,coalesce(a.rglt_chk_rejc_cntn,'') as rglt_chk_rejc_cntn
			  ,a.rglt_chk_rejc_usr_id
			  ,fn_get_time(a.rglt_chk_rejc_dt, #{SESS_TIME_ZONE},'DT', '-') as rglt_chk_rejc_dt
			  ,case when a.rglt_chk_mtrl_usg_yn = 'Y' then (select m.mlang_cntn 
														      from tb_co_mlang m
														     where m.lang_cd = #{SESS_LANG}
														       and m.mlang_no = 'LB00000379'
														   )
		            else (select m.mlang_cntn 
					        from tb_co_mlang m
					       where m.lang_cd = #{SESS_LANG}
					         and m.mlang_no = 'LB00000380'
					     )
		       end as rglt_chk_mtrl_use_nm 
		       ,(select b.chmt_mtra_rgln_exmt_excl_txt 
		       		  from tb_ch_rglt_chk_req b
               		where b.rglt_chk_no = a.rglt_chk_no) as chmt_mtra_rgln_exmt_excl_txt
		  from tb_ch_rglt_chk_doma_rslt a
		 where a.del_yn = 'N'
		   and a.rglt_chk_doma_cd = 'Z'
		   and a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
	</select>
	
	<!-- 규제검토 규제물질 삭제 -->
    <delete id="deleteRgltChkRgltSbst" parameterType="sqlMap">
        /* deleteRgltChkRgltSbst */
        delete 
          from tb_ch_rglt_chk_rglt_sbst
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no}
		   and rglt_no = #{rglt_no}
    </delete>
    
    <!-- 규제검토 규제물질 추가 -->
	<insert id="insertRgltChkRgltSbstSave" parameterType="sqlMap">
        /* insertRgltChkRgltSbstSave */
        insert into tb_ch_rglt_chk_rglt_sbst (
        	 rglt_chk_no
        	,chk_req_clsf_cd
        	,mtrl_no
        	,rglt_no
        	,sbst_no
        	,sbst_seq
        	,lggosi_id
			,lgnoti_no
			,lgnoti_nm
			,lgnoti_da
			,lgnoti_law_nm
			,lgnoti_law_no
			,lgnoti_law_cntn
        	,rglt_crtr_rati
			,rglt_crtr_cntn
			,rglt_sbst_note
			,del_yn
			,crt_usr_id
			,crt_dt
			,upt_usr_id
			,upt_dt
		) values (
		 	 #{rglt_chk_no}
        	,#{chk_req_clsf_cd}
        	,#{mtrl_no}
        	,#{rglt_no}
        	,#{sbst_no}
			,coalesce(#{sbst_seq}::integer, 1)
        	,coalesce(#{lggosi_id}, '')
			,coalesce(#{lgnoti_no}, '')
			,coalesce(#{lgnoti_nm}, '')
			,coalesce(#{lgnoti_da}, '')
			,coalesce(#{lgnoti_law_nm}, '')
			,coalesce(#{lgnoti_law_no}, '')
			,coalesce(#{lgnoti_law_cntn}, '')
	        ,coalesce(#{rglt_crtr_rati}::numeric, 0)
			,coalesce(#{rglt_crtr_cntn}, '')
			,coalesce(#{rglt_sbst_note}, '')
		    ,'N'
		    ,#{username}
		    ,to_char(now(), 'YYYYMMDDHH24MISS')
		    ,#{username}
		    ,to_char(now(), 'YYYYMMDDHH24MISS')
		)
    </insert>
    
    <!-- 규제검토 성분정보 추가 -->
	<insert id="insertRgltChkCnstF" parameterType="sqlMap">
        /* insertRgltChkCnstF */
        insert into tb_ch_rglt_chk_cnst (
        	 rglt_chk_no
        	,chk_req_clsf_cd
        	,mtrl_no
        	,comp_cnst_no
        	,cas_no
        	,comp_cnst_ratio
        	,comp_cnst_ko_nm
			,comp_cnst_en_nm
			,comp_cnst_zh_nm
			,comp_cnst_func_ko_nm
			,comp_cnst_func_en_nm
			,mix_rglt_cntn
			,glob_prhb_yn
			,del_yn
			,crt_usr_id
			,crt_dt
			,upt_usr_id
			,upt_dt
		)
		select a.rglt_chk_no 
		      ,'2'
		      ,a.mtrl_no 
		      ,a.comp_cnst_no
		      ,a.cas_no
		      ,a.comp_cnst_ratio
		      ,a.comp_cnst_ko_nm
		      ,a.comp_cnst_en_nm
		      ,a.comp_cnst_zh_nm
		      ,a.comp_cnst_func_ko_nm
		      ,a.comp_cnst_func_en_nm
		      ,a.mix_rglt_cntn
		      ,a.glob_prhb_yn
		      ,'N'
		      ,#{username}
		      ,to_char(now(), 'YYYYMMDDHH24MISS')
		      ,#{username}
		      ,to_char(now(), 'YYYYMMDDHH24MISS')
		  from tb_ch_rglt_chk_cnst a
		 where a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
    </insert>
    
    <!-- 규제검토 상태변경 -->
    <update id="updateRgltChkStatChg" parameterType="sqlMap">
        /* updateRgltChkStatChg */
        update tb_ch_rglt_chk
		   set rglt_chk_prog_stt_cd = #{rglt_chk_prog_stt_cd}
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
    </update>
    
    <!-- 규제검토 결재 상신 -->
    <update id="updateRgltChkAprvChg" parameterType="sqlMap">
        /* updateRgltChkStatChg */
        update tb_ch_rglt_chk
		   set aprv_no = #{aprv_no}
		   	  ,aprv_crt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
    </update>
    
    <!-- 규제검토 검토반려 -->
    <update id="updateRgltChkReject" parameterType="sqlMap">
        /* updateRgltChkReject */
        update tb_ch_rglt_chk
		   set chk_type_cd = '2'
		      ,rglt_chk_prog_stt_cd = #{rglt_chk_prog_stt_cd}
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
    </update>
    
    <!-- 규제검토 검토반려 취소 -->
    <update id="updateRgltChkRejectCancel" parameterType="sqlMap">
        /* updateRgltChkRejectCancel */
        update tb_ch_rglt_chk
		   set chk_type_cd = '2'
		      ,rglt_chk_prog_stt_cd = #{rglt_chk_prog_stt_cd}
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
    </update>
    
    <!-- 규제검토요청 상태변경 -->
    <update id="updateRgltChkReqStatChg" parameterType="sqlMap">
        /* updateRgltChkReqStatChg */
        update tb_ch_rglt_chk_req
		   set rglt_chk_req_prog_stt_cd = #{rglt_chk_req_prog_stt_cd}
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
    </update>
    
    <!-- 규제검토요청 상태변경 반려취소 -->
    <update id="updateRgltChkReqStatChgRejectCancel" parameterType="sqlMap">
        /* updateRgltChkReqStatChgRejectCancel */
        update tb_ch_rglt_chk_req
		   set rglt_chk_req_prog_stt_cd = #{rglt_chk_req_prog_stt_cd}
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
    </update>
    
    <!-- 규제검토 검토반려 -->
    <update id="updateRgltChkDomaRsltReject" parameterType="sqlMap">
        /* updateRgltChkDomaRsltReject */
        update tb_ch_rglt_chk_doma_rslt
		   set rglt_chk_rejc_usr_id = #{username}
		      ,rglt_chk_rejc_cntn = #{rglt_chk_rejc_cntn}
		      ,rglt_chk_rejc_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and rglt_chk_doma_cd = #{rglt_chk_doma_cd}
    </update>
    
    <!-- 규제검토 검토반려 취소 -->
    <update id="updateRgltChkDomaRsltRejectCancel" parameterType="sqlMap">
        /* updateRgltChkDomaRsltRejectCancel */
        update tb_ch_rglt_chk_doma_rslt
		   set rglt_chk_rejc_usr_id = null
		      ,rglt_chk_rejc_cntn = null
		      ,rglt_chk_rejc_dt = null
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and rglt_chk_doma_cd = #{rglt_chk_doma_cd}
    </update>
    
    <!-- 규제검토 대상 제외 자재 추가 - 코드 -->
    <insert id="insertRgltChkExceptionCd" parameterType="sqlMap">
        /* insertRgltChkExceptionCd */
        insert into tb_co_cd (
               cd_grp_no
              ,cd
              ,sort_seq
              ,usg_yn
              ,del_yn
              ,crt_usr_id
              ,crt_dt
              ,upt_usr_id
              ,upt_dt
		)
		select 'CH00000030'
	 		  ,#{imk_item_no}
	 		  ,1
	 		  ,'Y'
	 		  ,'N'
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
	     where not exists (select 1 from tb_co_cd where cd_grp_no = 'CH00000030' and cd = #{imk_item_no})
    </insert>
    
    <!-- 규제검토 대상 제외 자재 추가 - 다국어 -->
    <insert id="insertRgltChkExceptionLang" parameterType="sqlMap">
        /* insertRgltChkExceptionLang */
        insert into tb_co_mlang (
               mlang_no
              ,lang_cd
              ,mlang_type_cd
              ,biz_cd
              ,mlang_cntn
              ,cd_grp_no
              ,cd
              ,usg_yn
              ,del_yn
              ,crt_usr_id
              ,crt_dt
              ,upt_usr_id
              ,upt_dt
		)
		select #{imk_item_no}
		      ,cd as lang_cd
		      ,'CD'
		      ,'CH'
		      ,#{mtrl_nm}
		      ,'CH00000030'
		      ,#{imk_item_no}
	 		  ,'Y'
	 		  ,'N'
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
		  from tb_co_cd cd 
		 where cd.cd_grp_no = 'CO00000002'
	       and not exists (select 1 from tb_co_cd where cd_grp_no = 'CH00000030' and cd = #{imk_item_no})
    </insert>
    
    <!-- 규제검토 분야별 담당자 저장 -->
    <insert id="insertRgltChkDomaRslt" parameterType="sqlMap">
        /* insertRgltChkDomaRslt */
        with upsert as (
		update tb_ch_rglt_chk_doma_rslt
		   set rglt_chk_usr_id      = #{username}
		      ,rglt_chk_dt          = to_char(now(), 'YYYYMMDDHH24MISS')
		      ,rglt_chk_mtrl_usg_yn = #{rglt_chk_mtrl_usg_yn}
		      ,rglt_chk_rslt_cntn   = #{rglt_chk_rslt_cntn}
		      ,rglt_chk_rejc_cntn   = #{rglt_chk_rejc_cntn}
		      ,upt_usr_id           = #{username}
		      ,upt_dt               = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and rglt_chk_doma_cd = #{rglt_chk_doma_cd} RETURNING *
		)
		insert into tb_ch_rglt_chk_doma_rslt (
			   rglt_chk_no
        	  ,chk_req_clsf_cd
        	  ,rglt_chk_doma_cd
        	  ,rglt_chk_usr_id
        	  ,rglt_chk_dt
        	  ,rglt_chk_mtrl_usg_yn
			  ,rglt_chk_rslt_cntn
			  ,rglt_chk_rejc_cntn
			  ,del_yn
			  ,crt_usr_id
			  ,crt_dt
			  ,upt_usr_id
			  ,upt_dt
		)
		select #{rglt_chk_no}
	 		  ,#{chk_req_clsf_cd}
	 		  ,#{rglt_chk_doma_cd}
	 		  ,#{username}
			  ,to_char(now(), 'YYYYMMDD')
			  ,#{rglt_chk_mtrl_usg_yn}
			  ,#{rglt_chk_rslt_cntn}
			  ,#{rglt_chk_rejc_cntn}
			  ,'N'
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
	     where not exists (select * from upsert)
    </insert>
    
    <!-- 규제검토 성분정보 전체삭제 -->
    <delete id="deleteRgltChkCnstAll" parameterType="sqlMap">
        /* deleteRgltChkCnstAll */
        delete 
          from tb_ch_rglt_chk_cnst
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd_temp}
		   and mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토 구성성분 전체삭제 -->
    <delete id="deleteRgltChkSbstAll" parameterType="sqlMap">
        /* deleteRgltChkSbstAll */
        delete 
          from tb_ch_rglt_chk_sbst
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd_temp}
		   and mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토 규제 전체삭제 -->
    <delete id="deleteRgltChkRgltAll" parameterType="sqlMap">
        /* deleteRgltChkRgltAll */
        delete 
          from tb_ch_rglt_chk_rglt
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd_temp}
		   and mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토 규제물질 전체삭제 -->
    <delete id="deleteRgltChkRgltSbstAll" parameterType="sqlMap">
        /* deleteRgltChkRgltSbst */
        delete 
          from tb_ch_rglt_chk_rglt_sbst
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd_temp}
		   and mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토 경고표지 전체삭제 -->
    <delete id="deleteRgltChkGwsgnAll" parameterType="sqlMap">
        /* deleteRgltChkGwsgnAll */
        delete 
          from tb_ch_rglt_chk_gwsgn
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd_temp}
		   and mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토 그림문자 전체삭제 -->
    <delete id="deleteRgltChkPicgAll" parameterType="sqlMap">
        /* deleteRgltChkPicgAll */
        delete 
          from tb_ch_rglt_chk_gwsgn_picg
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd_temp}
		   and mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토 MSDS 전체삭제 -->
    <delete id="deleteRgltChkMsdsAll" parameterType="sqlMap">
        /* deleteRgltChkMsdsAll */
        delete 
          from tb_ch_rglt_chk_msds
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd_temp}
		   and mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토 MSDS 정보 조회 -->
	<select id="selectRgltChkMsdsInfo" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkMsdsInfo */
		select a.rglt_chk_no 
		      ,a.chk_req_clsf_cd 
		      ,a.mtrl_no 
		      ,a.msds_ver
		      ,a.enact_da
		      ,a.rev_da
		      ,a.ko_atfl_no 
		      ,a.en_atfl_no 
		      ,(select f.atfl_nm as name
		          from tb_co_atfl f
				 where f.atfl_no = a.ko_atfl_no limit 1
			   ) as ko_atfl_nm
			  ,(select f.atfl_nm as name
		          from tb_co_atfl f
				 where f.atfl_no = a.en_atfl_no limit 1
			   ) as en_atfl_nm
		      ,(select f.atfl_no || '-' || f.atfl_seq as key
		          from tb_co_atfl f
				 where f.atfl_no = a.ko_atfl_no limit 1
			   ) as ko_atfl_key
			  ,(select f.atfl_no || '-' || f.atfl_seq as key
		          from tb_co_atfl f
				 where f.atfl_no = a.en_atfl_no limit 1
			   ) as en_atfl_key
		  from tb_ch_rglt_chk_msds a
		 where a.del_yn = 'N'
		   and a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
	</select>
	
	<!-- 규제검토 MSDS 저장 -->
    <insert id="insertRgltChkMsdsInfo" parameterType="sqlMap">
        /* insertRgltChkMsdsInfo */
        with upsert as (
		update tb_ch_rglt_chk_msds
		   set ko_atfl_no      	= #{ko_atfl_no}
		      ,en_atfl_no         = #{en_atfl_no}
		      ,msds_ver				= #{msds_ver}
		      ,rev_da				= #{rev_da}
		      ,enact_da				= #{enact_da}
		      ,upt_usr_id           = #{username}
		      ,upt_dt               = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no} RETURNING *
		)
		insert into tb_ch_rglt_chk_msds (
			   rglt_chk_no
        	  ,chk_req_clsf_cd
        	  ,mtrl_no
        	  ,msds_ver
        	  ,rev_da
        	  ,enact_da
        	  ,ko_atfl_no
        	  ,en_atfl_no
			  ,del_yn
			  ,crt_usr_id
			  ,crt_dt
			  ,upt_usr_id
			  ,upt_dt
		)
		select #{rglt_chk_no}
	 		  ,#{chk_req_clsf_cd}
	 		  ,#{mtrl_no}
	 		  ,#{msds_ver}
	 		  ,#{rev_da}
	 		  ,#{enact_da}
			  ,#{ko_atfl_no}
			  ,#{en_atfl_no}
			  ,'N'
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{username}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
	     where not exists (select * from upsert)
    </insert>
    
    <!-- 규제검토요청 권한 체크 -->
	<select id="selectRgltChkReqAuthChk" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkReqAuthChk */
		select a.rglt_chk_no 
		      ,a.dept_yn
		      ,a.stt_yn
		      ,a.rglt_chk_req_prog_stt_cd
		      ,case when a.dept_yn = 'Y' and a.stt_yn = 'Y' then 'Y' else 'N' end as auth_chk
		  from (select a.rglt_chk_no 
				      ,(select case when count(1) > 0 then 'Y' else 'N' end dept_yn
				          from tb_co_user u
				         where u.usr_id = #{sess_usr_id}
				           and u.dept_cd = (select r.dept_cd 
				                              from tb_co_user r
				                             where r.usr_id = a.rglt_chk_req_usr_id 
				                           )
				       ) as dept_yn
				      ,case when a.rglt_chk_req_prog_stt_cd != '30' then 'Y' else 'N' end stt_yn 
				      ,a.rglt_chk_req_prog_stt_cd
				  from tb_ch_rglt_chk_req a
				 where a.del_yn = 'N'
				   and a.rglt_chk_no = #{rglt_chk_no}
				   and a.chk_req_clsf_cd = '1'
			   ) a
	</select>
	
	<!-- 규제검토 권한 체크 -->
	<select id="selectRgltChkAuthChk" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkAuthChk */
		select a.rglt_chk_no 
		      ,a.site_yn
		      ,a.auth_yn
		      ,a.stt_yn
		      ,a.rglt_chk_prog_stt_cd
		      ,case when a.admin_yn = 'Y' then 'Y'
		      		when a.admin_yn = 'N' and a.site_yn = 'Y' and a.auth_yn = 'Y' and a.stt_yn = 'Y' then 'Y'
		      		else 'N'
		      	end as auth_chk
		  from (select a.rglt_chk_no
				      ,(select case when count(1) > 0 then 'Y' else 'N' end
				          from tb_co_user_role u
				         where u.usr_id = #{sess_usr_id}
				           and u.role_no = 'RZZZZ'
				           and u.del_yn = 'N'
				       ) as admin_yn 
				      ,(select case when count(1) > 0 then 'Y' else 'N' end site_yn
				          from tb_co_user u
				         where u.usr_id = #{sess_usr_id}
				           and u.wkpl_id = a.wkpl_id
				       ) as site_yn
				      ,(select case when count(1) > 0 then 'Y' else 'N' end aute_yn
				          from tb_co_user_role u
				         where u.usr_id = #{sess_usr_id}
				           and u.role_no = 'R0003'
				           and u.del_yn = 'N'
				       ) as auth_yn
				      ,case when a.rglt_chk_prog_stt_cd in ('30', '40', '50', '70') then 'Y'
				      		else 'N'
				      	end stt_yn 
		     		  ,a.rglt_chk_prog_stt_cd 
				  from tb_ch_rglt_chk a
				 where a.del_yn = 'N'
				   and a.rglt_chk_no = #{rglt_chk_no}
				   and a.chk_req_clsf_cd = '2'
			   ) a
	</select>
	
	<!-- 규제검토 검토요청 메일 수신자 조회 -->
	<select id="selectRgltChkReqMailReceiver" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkReqMailReceiver */
		select a.usr_id 
		      ,a.cnct_1st_cd
		      ,a.cnct_2nd_cd 
		      ,case when #{SESS_LANG} = 'KO' then (select tcu.usr_ko_nm  from tb_co_user tcu where tcu.usr_id = a.usr_id)
					when #{SESS_LANG} = 'EN' then	(select tcu.usr_en_nm  from tb_co_user tcu where tcu.usr_id = a.usr_id)   
					else (select tcu.usr_zh_nm  from tb_co_user tcu where tcu.usr_id = a.usr_id)   
			   end as usr_nm
		  from tb_co_biz_pc a
		 where a.biz_pc_grp_cd  = 'BG00001'
		   and a.cnct_2nd_cd = 'Z'
		   and a.del_yn = 'N'
		   and a.cnct_1st_cd = #{wkpl_id}
	</select>
	
	<!-- 규제검토 업무 담당자 조회 -->
	<select id="selectRgltChkBizUser" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkBizUser */
		select a.usr_id 
		      ,a.cnct_1st_cd
		      ,a.cnct_2nd_cd 
		      ,case when #{SESS_LANG} = 'KO' then (select tcu.usr_ko_nm  from tb_co_user tcu where tcu.usr_id = a.usr_id)
					when #{SESS_LANG} = 'EN' then	(select tcu.usr_en_nm  from tb_co_user tcu where tcu.usr_id = a.usr_id)   
					else (select tcu.usr_zh_nm  from tb_co_user tcu where tcu.usr_id = a.usr_id)   
			   end as usr_nm
		  from tb_co_biz_pc a
		 where a.biz_pc_grp_cd  = 'BG00001'
		   and a.cnct_2nd_cd = 'Z'
		   and a.del_yn = 'N'
	</select>
	
	<!-- 규제검토 MSDS정보 복사 -->
	<insert id="insertRgltChkMsdsF" parameterType="sqlMap">
        /* insertRgltChkMsdsF */
        insert into tb_ch_rglt_chk_msds (
        	 rglt_chk_no
        	,chk_req_clsf_cd
        	,mtrl_no
        	,msds_ver
        	,enact_da
        	,rev_da
        	,reg_da
			,reg_usr_id
			,ko_atfl_no
			,en_atfl_no
			,del_yn
			,crt_usr_id
			,crt_dt
			,upt_usr_id
			,upt_dt
		)
		select a.rglt_chk_no 
		      ,'2'
		      ,a.mtrl_no 
		      ,a.msds_ver
		      ,a.enact_da
		      ,a.rev_da
		      ,a.reg_da
		      ,a.reg_usr_id
		      ,a.ko_atfl_no
		      ,a.en_atfl_no
		      ,'N'
		      ,#{username}
		      ,to_char(now(), 'YYYYMMDDHH24MISS')
		      ,#{username}
		      ,to_char(now(), 'YYYYMMDDHH24MISS')
		  from tb_ch_rglt_chk_msds a
		 where a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
    </insert>
    
    <!-- 규제검토 결재정보 조회 -->
	<select id="selectRgltChkAprvBasicInfo" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkAprvBasicInfo */
		select a.rglt_chk_no 
		      ,a.chk_req_clsf_cd 
		      ,b.mtrl_no
		      ,b.mtrl_ko_nm
		      ,b.mtrl_en_nm
		      ,b.mtrl_zh_nm
		      ,(select r.rglt_chk_usr_id 
		         from tb_ch_rglt_chk_doma_rslt r
		        where r.rglt_chk_no = a.rglt_chk_no 
		          and r.chk_req_clsf_cd = a.chk_req_clsf_cd 
		          and r.rglt_chk_doma_cd = 'Z'
		       ) as rglt_chk_usr_id
		       ,b.mtrl_clsf_cd
		       ,b.mtrl_kind_cd
		       ,a.wkpl_id
		       ,coalesce(b.dngr_kind_cd, '') as dngr_kind_cd
			   ,coalesce(b.dngr_dtl_kind_cd, '') as dngr_dtl_kind_cd
			   ,b.mtrl_fspt_infr_estn_yn
			   ,b.mtrl_fspt_vl
		  from tb_ch_rglt_chk a
		      ,tb_ch_rglt_chk_mtrl b
		 where a.rglt_chk_no = b.rglt_chk_no 
		   and a.chk_req_clsf_cd = b.chk_req_clsf_cd 
		   and a.del_yn = 'N'
		   and b.del_yn = 'N'
		   and a.aprv_no = #{aprv_no}
	</select>
	
	<!-- 규제검토 결재 물질 전체삭제 -->
    <delete id="deleteRgltChkAprvSbstAll" parameterType="sqlMap">
        /* deleteRgltChkAprvSbstAll */
        delete 
          from tb_ch_mtrl_sbst
		 where mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토 결재 규제 전체삭제 -->
    <delete id="deleteRgltChkAprvRgltAll" parameterType="sqlMap">
        /* deleteRgltChkAprvRgltAll */
        delete 
          from tb_ch_mtrl_rglt
		 where mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토 결재 규제물질 전체삭제 -->
    <delete id="deleteRgltChkAprvRgltSbstAll" parameterType="sqlMap">
        /* deleteRgltChkAprvRgltSbstAll */
        delete 
          from tb_ch_mtrl_rglt_sbst
		 where mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토 결재 경고표지 전체삭제 -->
    <delete id="deleteRgltChkAprvGwsgnAll" parameterType="sqlMap">
        /* deleteRgltChkAprvGwsgnAll */
        delete 
          from tb_ch_mtrl_gwsgn
		 where mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토 결재 그림문자 전체삭제 -->
    <delete id="deleteRgltChkAprvPicgAll" parameterType="sqlMap">
        /* deleteRgltChkAprvPicgAll */
        delete 
          from tb_ch_mtrl_gwsgn_picg
		 where mtrl_no = #{mtrl_no}
    </delete>
    
    <!-- 규제검토 결재 MSDS 전체삭제 -->
    <delete id="deleteRgltChkAprvMsdsAll" parameterType="sqlMap">
        /* deleteRgltChkAprvMsdsAll */
        delete 
          from tb_ch_mtrl_msds
		 where mtrl_no = #{mtrl_no}
    </delete>
	
	<!-- 규제검토 결재 자재수정 -->
    <update id="updateRgltChkAprvMtrlInfo" parameterType="sqlMap">
        /* updateRgltChkAprvMtrlInfo */
        update tb_co_mtrl
		   set rglt_chk_yn = 'Y'
		      ,rglt_chk_no = #{rglt_chk_no}
		      ,mtrl_ko_nm  = #{mtrl_ko_nm}
		      ,mtrl_en_nm  = #{mtrl_en_nm}
		      ,mtrl_zh_nm  = #{mtrl_zh_nm}
		      ,dngr_kind_cd = #{dngr_kind_cd}
		      ,dngr_dtl_kind_cd = #{dngr_dtl_kind_cd}
		      <if test='mtrl_kind_cd != null and (mtrl_kind_cd == "4" or mtrl_kind_cd == "3")'>
		      ,pchs_unit_cd = (select pchs_unit_cd from tb_ch_rglt_chk_mtrl where rglt_chk_no = #{rglt_chk_no} and chk_req_clsf_cd = '2' and usg_yn = 'Y')
		      ,pchs_unit_weght = (select pchs_unit_weght from tb_ch_rglt_chk_mtrl where rglt_chk_no = #{rglt_chk_no} and chk_req_clsf_cd = '2' and usg_yn = 'Y')
		      ,pchs_unit_nm = (select pchs_unit_nm from tb_ch_rglt_chk_mtrl where rglt_chk_no = #{rglt_chk_no} and chk_req_clsf_cd = '2' and usg_yn = 'Y')
		      ,pchs_req_unit_cd = (select pchs_req_unit_cd from tb_ch_rglt_chk_mtrl where rglt_chk_no = #{rglt_chk_no} and chk_req_clsf_cd = '2' and usg_yn = 'Y')
		      ,pchs_req_unit_weght = (select pchs_req_unit_weght from tb_ch_rglt_chk_mtrl where rglt_chk_no = #{rglt_chk_no} and chk_req_clsf_cd = '2' and usg_yn = 'Y')
		      ,pchs_req_unit_nm = (select pchs_req_unit_nm from tb_ch_rglt_chk_mtrl where rglt_chk_no = #{rglt_chk_no} and chk_req_clsf_cd = '2' and usg_yn = 'Y')
		      </if>
		      ,mtrl_fspt_infr_estn_yn = #{mtrl_fspt_infr_estn_yn}
		      ,mtrl_fspt_vl = case when #{mtrl_fspt_vl}::text = '' then NULL
		                           when #{mtrl_fspt_vl} = NULL then NULL
		                           else #{mtrl_fspt_vl}::numeric
		                       end
		      ,upt_usr_id = #{rglt_chk_usr_id}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where mtrl_no = #{mtrl_no}
    </update>
    
    <!-- 규제검토 결재 상태 수정 -->
    <update id="updateRgltChkAprvChkInfo" parameterType="sqlMap">
        /* updateRgltChkAprvChkInfo */
        update tb_ch_rglt_chk
		   set rglt_chk_prog_stt_cd = #{rglt_chk_prog_stt_cd}
		      ,aprv_cmpt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		      ,upt_usr_id = #{rglt_chk_usr_id}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
    </update>
    
    <!-- 규제검토 결재 물질 추가 -->
	<insert id="insertRgltChkAprvSbst" parameterType="sqlMap">
        /* insertRgltChkAprvSbst */
        insert into tb_ch_mtrl_sbst (
        	   mtrl_no
        	  ,sbst_no
        	  ,sbst_seq
        	  ,sbst_rati
        	  ,sbst_note
        	  ,sbst_type_cd
        	  ,sbst_ko_nm
        	  ,sbst_en_nm
			  ,cas_no
			  ,ko_syno_nm
			  ,en_syno_nm
			  ,ke_no
			  ,ec_no
			  ,nfpa_he_cd
			  ,nfpa_fire_cd
			  ,nfpa_creac_cd
			  ,phase_1st_cntn
			  ,phase_2nd_cntn
			  ,clr_cntn
			  ,odor_cntn
			  ,odor_thshld_cntn
			  ,ph_cntn
			  ,ph_val
			  ,meltp_cntn
			  ,boilp_cntn
			  ,boilp_val
			  ,boinp_unit_nm
			  ,flashp_cntn
			  ,flashp_val
			  ,flashp_unit_nm
			  ,mol_wgt_cntn
			  ,eva_rate_cntn
			  ,flamabl_cntn
			  ,explos_cntn
			  ,stpress_cntn
			  ,solub_cntn
			  ,vapden_cntn
			  ,spgrav_cntn
			  ,kow_cntn
			  ,autoigt_cntn
			  ,thermsis_cntn
			  ,visco_cntn
			  ,usg_yn
			  ,del_yn
			  ,crt_usr_id
			  ,crt_dt
			  ,upt_usr_id
			  ,upt_dt
		)
		select a.mtrl_no
		      ,a.sbst_no 
		      ,a.sbst_seq 
		      ,a.sbst_rati
		      ,a.sbst_note
		      ,a.sbst_type_cd
		      ,b.sbst_ko_nm
		      ,b.sbst_en_nm 
		      ,a.cas_no 
		      ,b.ko_syno_nm 
		      ,b.en_syno_nm 
		      ,b.ke_no 
		      ,b.ec_no 
		      ,b.nfpa_he_cd 
		      ,b.nfpa_fire_cd 
		      ,b.nfpa_creac_cd 
		      ,b.phase_1st_cntn 
		      ,b.phase_2nd_cntn 
		      ,b.clr_cntn 
		      ,b.odor_cntn 
		      ,b.odor_thshld_cntn 
		      ,b.ph_cntn 
		      ,b.ph_val 
		      ,b.meltp_cntn 
		      ,b.boilp_cntn 
		      ,b.boilp_val 
		      ,b.boinp_unit_nm 
		      ,b.flashp_cntn 
		      ,b.flashp_val 
		      ,b.flashp_unit_nm 
		      ,b.mol_wgt_cntn
		      ,b.eva_rate_cntn 
		      ,b.flamabl_cntn 
		      ,b.explos_cntn 
		      ,b.stpress_cntn 
		      ,b.solub_cntn 
		      ,b.vapden_cntn 
		      ,b.spgrav_cntn 
		      ,b.kow_cntn 
		      ,b.autoigt_cntn 
		      ,b.thermsis_cntn 
		      ,b.visco_cntn 
		      ,'Y'
		      ,'N'
		      ,#{rglt_chk_usr_id}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{rglt_chk_usr_id}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
		  from tb_ch_rglt_chk_sbst a
		      ,tb_ch_sbst b
		 where a.del_yn = 'N'
		   and b.del_yn = 'N'
		   and a.sbst_no = b.sbst_no 
		   and a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
    </insert>
    
    <!-- 규제검토 규제정보 생성 -->
	<insert id="insertRgltChkAprvRgltList" parameterType="sqlMap">
        /* insertRgltChkAprvRgltList */
        insert into tb_ch_mtrl_rglt (
        	   mtrl_no
        	  ,rglt_no
        	  ,nat_cd
        	  ,rglt_type_cd
        	  ,rglt_chk_doma_cd
			  ,law_cd
			  ,rglt_nm
			  ,rglt_abbr
			  ,sort_seq
			  ,usg_yn
			  ,del_yn
			  ,crt_usr_id
			  ,crt_dt
			  ,upt_usr_id
			  ,upt_dt
			  ,rglt_note
			  ,rglt_obj_yn
		)
	 	select a.mtrl_no
		      ,a.rglt_no 
		      ,a.nat_cd
		      ,a.rglt_type_cd
		      ,a.rglt_chk_doma_cd
		      ,a.law_cd
		      ,a.rglt_nm
		      ,a.rglt_abbr
		      ,a.sort_seq
		      ,'Y'
		      ,'N'
		      ,#{rglt_chk_usr_id}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,#{rglt_chk_usr_id}
			  ,to_char(now(), 'YYYYMMDDHH24MISS')
			  ,a.rglt_note
			  ,a.rglt_obj_yn
		  from tb_ch_rglt_chk_rglt a
		 where a.del_yn = 'N'
		   and a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
    </insert>
    
    <!-- 규제검토 결재 규제물질 추가 -->
	<insert id="insertRgltChkAprvRgltSbst" parameterType="sqlMap">
        /* insertRgltChkAprvRgltSbst */
        insert into tb_ch_mtrl_rglt_sbst (
        	 mtrl_no
        	,rglt_no
        	,sbst_no
        	,sbst_seq
        	,lggosi_id
			,lgnoti_no
			,lgnoti_nm
			,lgnoti_da
			,lgnoti_law_nm
			,lgnoti_law_no
			,lgnoti_law_cntn
        	,rglt_crtr_rati
			,rglt_crtr_cntn
			,rglt_sbst_note
			,usg_yn
			,del_yn
			,crt_usr_id
			,crt_dt
			,upt_usr_id
			,upt_dt
		)
		select a.mtrl_no 
		      ,a.rglt_no
		      ,a.sbst_no
		      ,a.sbst_seq 
		      ,a.lggosi_id
			  ,a.lgnoti_no
		      ,a.lgnoti_nm
			  ,a.lgnoti_da
			  ,a.lgnoti_law_nm
			  ,a.lgnoti_law_no
			  ,a.lgnoti_law_cntn
		      ,a.rglt_crtr_rati 
		      ,a.rglt_crtr_cntn
		      ,a.rglt_sbst_note
		      ,'Y'
		      ,'N'
		      ,#{rglt_chk_usr_id}
		      ,to_char(now(), 'YYYYMMDDHH24MISS')
		      ,#{rglt_chk_usr_id}
		      ,to_char(now(), 'YYYYMMDDHH24MISS')
		  from tb_ch_rglt_chk_rglt_sbst a
		 where a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
		   and a.del_yn = 'N'
    </insert>
    
    <!-- 규제검토 결재 MSDS정보 복사 -->
	<insert id="insertRgltChkAprvMsds" parameterType="sqlMap">
        /* insertRgltChkAprvMsds */
        insert into tb_ch_mtrl_msds (
        	 mtrl_no
        	,msds_ver
        	,enact_da
        	,rev_da
        	,reg_da
			,reg_usr_id
			,ko_atfl_no
			,en_atfl_no
			,del_yn
			,crt_usr_id
			,crt_dt
			,upt_usr_id
			,upt_dt
		)
		select a.mtrl_no 
		      ,a.msds_ver
		      ,a.enact_da
		      ,a.rev_da
		      ,a.reg_da
		      ,a.reg_usr_id
		      ,a.ko_atfl_no
		      ,a.en_atfl_no
		      ,'N'
		      ,#{rglt_chk_usr_id}
		      ,to_char(now(), 'YYYYMMDDHH24MISS')
		      ,#{rglt_chk_usr_id}
		      ,to_char(now(), 'YYYYMMDDHH24MISS')
		  from tb_ch_rglt_chk_msds a
		 where a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
		   and a.del_yn = 'N'
    </insert>
    
    <!-- 규제검토 결재 경고표지 복사 -->
	<insert id="insertRgltChkAprvGwsgn" parameterType="sqlMap">
        /* insertRgltChkAprvGwsgn */
        insert into tb_ch_mtrl_gwsgn (
        	 mtrl_no
        	,sgw_cd
        	,hars_cntn
        	,prv_cntn
        	,act_cntn
			,str_cntn
			,scr_cntn
			,vndr_no
			,del_yn
			,crt_usr_id
			,crt_dt
			,upt_usr_id
			,upt_dt
		)
		select a.mtrl_no 
		      ,a.sgw_cd
		      ,a.hars_cntn
		      ,a.prv_cntn
		      ,a.act_cntn
		      ,a.str_cntn
		      ,a.scr_cntn
		      ,a.vndr_no
		      ,'N'
		      ,#{rglt_chk_usr_id}
		      ,to_char(now(), 'YYYYMMDDHH24MISS')
		      ,#{rglt_chk_usr_id}
		      ,to_char(now(), 'YYYYMMDDHH24MISS')
		  from tb_ch_rglt_chk_gwsgn a
		 where a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
		   and a.del_yn = 'N'
    </insert>
    
    <!-- 규제검토 결재 그림문자 복사 -->
	<insert id="insertRgltChkAprvPicg" parameterType="sqlMap">
        /* insertRgltChkAprvGwsgn */
        insert into tb_ch_mtrl_gwsgn_picg (
        	 mtrl_no
        	,picg_cd
        	,print_yn
			,del_yn
			,crt_usr_id
			,crt_dt
			,upt_usr_id
			,upt_dt
		)
		select a.mtrl_no 
		      ,a.picg_cd
		      ,a.print_yn
		      ,'N'
		      ,#{rglt_chk_usr_id}
		      ,to_char(now(), 'YYYYMMDDHH24MISS')
		      ,#{rglt_chk_usr_id}
		      ,to_char(now(), 'YYYYMMDDHH24MISS')
		  from tb_ch_rglt_chk_gwsgn_picg a
		 where a.rglt_chk_no = #{rglt_chk_no}
		   and a.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and a.mtrl_no = #{mtrl_no}
		   and a.del_yn = 'N'
    </insert>
    
    <select id="selectRgltChkVndrKey" parameterType="sqlMap" resultType="string">
		/* selectRgltChkVndrKey */
		select concat('V', lpad(nextval('tb_co_vndr_seq')::text, 9, '0')) as key
	</select>
	
	<insert id="insertRgltChkVndrMstData" parameterType="sqlMap">
	   /* insertRgltChkVndrMstData */
       insert into tb_co_vndr(
					vndr_no 
				   ,vndr_nm 
				   ,vndr_clsf_cd 
				   ,vndr_type_cd 
				   ,nat_cd 
				   ,vndr_addr
				   ,vndr_phon_no 
				   ,vndr_rprs_nm 
				   ,vndr_crt_da 
				   ,vndr_upt_da 
				   ,vndr_coreg_no 
				   ,crt_usr_id 
				   ,crt_dt 
				   ,upt_usr_id 
				   ,upt_dt 
		) values (
					#{vndr_no}
				   ,#{vndr_nm}
				   ,#{vndr_clsf_cd}
				   ,#{vndr_type_cd}
				   ,#{nat_cd}
				   ,#{vndr_addr}
				   ,#{vndr_phon_no}
				   ,#{vndr_rprs_nm}
				   ,to_char(now(), 'YYYYMMDD')
				   ,to_char(now(), 'YYYYMMDD')
				   ,#{vndr_coreg_no}
				   ,#{rglt_chk_usr_id}
				   ,to_char(now(), 'YYYYMMDDHH24MISS')
				   ,#{rglt_chk_usr_id}
				   ,to_char(now(), 'YYYYMMDDHH24MISS')
		)
    </insert>
    
    <insert id="insertRgltChkMtrlVndrData" parameterType="sqlMap">
       /* insertRgltChkMtrlVndrData */
       insert into tb_co_mtrl_vndr(
					 mtrl_no
					,vndr_no
					,del_yn
					,crt_usr_id
					,crt_dt
					,upt_usr_id
					,upt_dt
					,cnfm_vndr_yn
		) values (
					#{mtrl_no}
				   ,#{vndr_no}
				   ,'N'
				   ,#{rglt_chk_usr_id}
				   ,to_char(now(), 'YYYYMMDDHH24MISS')
				   ,#{rglt_chk_usr_id}
				   ,to_char(now(), 'YYYYMMDDHH24MISS')
				   ,'Y'
		) on conflict (mtrl_no, vndr_no) DO
        update set
              mtrl_no = #{mtrl_no}
             ,vndr_no = #{vndr_no}
             ,del_yn = 'N'
             ,upt_usr_id = #{rglt_chk_usr_id}
             ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
             ,cnfm_vndr_yn = 'Y'
        where tb_co_mtrl_vndr.mtrl_no = #{mtrl_no}
          and tb_co_mtrl_vndr.vndr_no = #{vndr_no}
    </insert>
    
	<!-- 위험물_MES_송신 데이터 생성 -->    
	<insert id="insertDngrMtrlMesSend" parameterType="sqlMap">
 		/* insertDngrMtrlMesSend */
    	insert into ti_ch_dngr_mtrl_mes_send (
	        	    dngr_mtrl_send_seq
				   ,plant_cd
				   ,mtrl_cd
				   ,dngr_type1_nm
				   ,dngr_type2_nm
			       ,msds_rev_da
			       ,send_yn
			       ,send_dt
		)
    	select  nextval('ti_ch_dngr_mtrl_mes_send_dngr_mtrl_send_seq_seq'::regclass) as dngr_mtrl_send_seq
               ,(select tcms.plant_cd 
    			   from tb_co_mtrl_site tcms 
    		      where tcms.mtrl_no = tcrcm.mtrl_no 
    		        and tcms.wkpl_id = #{wkpl_id}
    		        and tcms.del_yn = 'N'
    		   ) as plant_cd
			   ,tcrcm.mtrl_no as mtrl_cd
			   ,fn_get_cd('CH00000027', tcrcm.dngr_kind_cd, 'nm', #{SESS_LANG}) as dngr_type1_nm
			   ,fn_get_cd('CH00000028', tcrcm.dngr_dtl_kind_cd, 'nm', #{SESS_LANG}) as dngr_type2_nm
			   ,(select case when tcrcms.rev_da is null or tcrcms.rev_da = '' then null 
		   		  														      else tcrcms.rev_da
		           		end
			       from tb_ch_rglt_chk_msds tcrcms
			      where tcrcms.rglt_chk_no	 = tcrcm.rglt_chk_no
				    and tcrcms.chk_req_clsf_cd = tcrcm.chk_req_clsf_cd
				    and tcrcms.mtrl_no 		 = tcrcm.mtrl_no
			    ) as msds_rev_da
			   ,'N'
			   ,'00000000000000'
	      from tb_ch_rglt_chk_mtrl tcrcm
	 	 where tcrcm.rglt_chk_no = #{rglt_chk_no}
		   and tcrcm.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and tcrcm.mtrl_no = #{mtrl_no}
		   and tcrcm.mtrl_clsf_cd = '1'
    </insert>
    
    <!-- 위험물 여부 확인 --> 
    <select id="selectRgltChkRgltSbstCnt" parameterType="sqlMap" resultType="sqlMap">
		/* selectRgltChkRgltSbstCnt */
		select COUNT(1) as cnt
		  from tb_ch_rglt_chk_rglt a
		  left join tb_ch_rglt_chk_rglt_sbst b 
		    on a.rglt_chk_no = b.rglt_chk_no
		   and a.chk_req_clsf_cd = b.chk_req_clsf_cd
		   and a.mtrl_no = b.mtrl_no
		   and a.rglt_no = b.rglt_no
		 where a.del_yn = 'N'
		   and b.del_yn = 'N'
		   and b.usg_yn = 'Y'
		   and b.rglt_chk_no = #{rglt_chk_no}
		   and b.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and b.mtrl_no = #{mtrl_no}
		   and a.rglt_no = #{rglt_no}
		   and a.law_cd =  #{law_cd}
	</select>
	
	<!-- 경고표지_MES_송신 데이터 생성 --> 
	<insert id="insertMtrlGwsgnMesSend" parameterType="sqlMap">
	/* insertMtrlGwsgnMesSend */
	 insert into ti_ch_mtrl_gwsgn_mes_send (
			 mtrl_gwsgn_send_seq							
			,mtrl_cd   
			,sgw_cd
			,hars_cntn
			,prv_cntn
			,act_cntn
			,str_cntn
			,scr_cntn
			,vndr_no
			,vndr_nm
			,vndr_addr
			,vndr_phon_no
			,picg_cd
			,crt_dt
			,send_yn
			,send_dt
	 )  
	 select  nextval('ti_ch_mtrl_gwsgn_mes_send_mtrl_gwsgn_send_seq_seq'::regclass) as mtrl_gwsgn_send_seq
			,rcg.mtrl_no as mtrl_cd
  			,rcg.sgw_cd 
  			,coalesce(rcg.hars_cntn,'') as hars_cntn
            ,coalesce(rcg.prv_cntn,'') as prv_cntn
            ,coalesce(rcg.act_cntn,'') as act_cntn
            ,coalesce(rcg.str_cntn,'') as str_cntn
            ,coalesce(rcg.scr_cntn,'') as scr_cntn
			,rcg.vndr_no
  			,rcg.vndr_nm
	        ,rcg.vndr_addr
	        ,rcg.vndr_phon_no
		    ,(select array_to_string(array_agg(rcgp.picg_cd),',')  
		      	from tb_ch_rglt_chk_gwsgn_picg rcgp
		       where rcgp.rglt_chk_no 	  = rcg.rglt_chk_no 
		         and rcgp.chk_req_clsf_cd = rcg.chk_req_clsf_cd
		         and rcgp.mtrl_no 		  = rcg.mtrl_no
		         and rcgp.print_yn        = 'Y'
		         and rcgp.del_yn 		  = 'N'
		    ) as picg_cd
		    ,to_char(now(), 'YYYYMMDDHH24MISS') as crt_dt
		    ,'N'
		    ,'00000000000000'
		  from tb_ch_rglt_chk_gwsgn rcg
		 where rcg.del_yn = 'N'
	  	   and rcg.rglt_chk_no = #{rglt_chk_no}
		   and rcg.chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and rcg.mtrl_no = #{mtrl_no}
		   and exists (select 1 from tb_ch_rglt_chk_mtrl mt where mt.mtrl_clsf_cd = '1' and mt.mtrl_no = rcg.mtrl_no)
   </insert>
	 
    <!-- 규제대상 여부 업데이트 -->
    <update id="updateRgltChkRgltSave" parameterType="sqlMap">
        /* updateRgltChkRgltSave */
        update tb_ch_rglt_chk_rglt
		   set rglt_obj_yn = #{tgt_yn}
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
		   and mtrl_no = #{mtrl_no}
		   and rglt_no = #{rglt_no}
		   and rglt_chk_doma_cd = (select max(aa.rglt_chk_doma_cd) 
		                             from tb_ch_rglt aa 
		                            where aa.rglt_no = #{rglt_no}
		                          )
    </update>
    
    <!-- 규제검토 목록 생성 후 규제대상 여부 업데이트 -->
    <update id="updateReqRgltChkRgltSave" parameterType="sqlMap">
        /* updateReqRgltChkRgltSave */
        update tb_ch_rglt_chk_rglt aa
		   set rglt_obj_yn = (select case when count(*) > 0 then 'Y' else 'N' end from tb_ch_rglt_chk_rglt_sbst bb where aa.rglt_chk_no = bb.rglt_chk_no and bb.chk_req_clsf_cd = '2' and bb.rglt_no = aa.rglt_no)
		 where aa.rglt_chk_no = #{rglt_chk_no}
		   and aa.chk_req_clsf_cd = '2'
    </update>
    
    <update id="updateRgltChkAprvGwsgn" parameterType="sqlMap">
        /* updateRgltChkAprvGwsgn */
        update tb_ch_mtrl_gwsgn
		   set vndr_no = #{vndr_no}
		 where mtrl_no = #{mtrl_no}
    </update>

	<!-- 규제검토요청 제외 사유 저장 -->
    <update id="updatetRgltChkReqException" parameterType="sqlMap">
        /* updatetRgltChkReqException */
        update tb_ch_rglt_chk_req
		   set rglt_chk_req_da = to_char(now(), 'YYYYMMDD') 
		   	  ,rgln_exmt_excl_rq_rsn_cd = #{rgln_exmt_excl_rq_rsn_cd}
		   	  ,chmt_mtra_rgln_exmt_excl_txt = #{chmt_mtra_rgln_exmt_excl_txt}
		   	  ,rglt_chk_req_prog_stt_cd = #{rglt_chk_req_prog_stt_cd}
		   	  ,chmt_mtra_rgln_exmt_excl_num = #{chmt_mtra_rgln_exmt_excl_num} + 1
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
    </update>
    
    <!-- 규제검토 적용제외 요청 승인 -->
    <update id="updateRgltChkExcReject" parameterType="sqlMap">
        /* updateRgltChkExcReject */
        update tb_ch_rglt_chk	
		   set chk_type_cd = '2'
		      ,rglt_chk_prog_stt_cd = #{rglt_chk_prog_stt_cd}
		      ,chmt_mtra_rgln_exmt_excl_yn = 'Y'
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where rglt_chk_no = #{rglt_chk_no}
		   and chk_req_clsf_cd = #{chk_req_clsf_cd}
    </update>
    
     <!-- 규제 테이블 제외여부  -->
    <update id="updateRgltExcMtrl" parameterType="sqlMap">
        /* updateRgltExcMtrl */
        update tb_co_mtrl	
		   set chmt_mtra_rgln_exmt_excl_yn = 'Y'
		      ,upt_usr_id = #{username}
		      ,upt_dt = to_char(now(), 'YYYYMMDDHH24MISS')
		 where mtrl_no = #{mtrl_no}
    </update>
    
</mapper>