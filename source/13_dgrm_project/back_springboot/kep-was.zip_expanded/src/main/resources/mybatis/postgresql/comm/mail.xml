<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kist.portal.common.email.mapper.sendMailMapper">
	
	<select id="selectEmailData" parameterType="sqlMap" resultType="sqlMap">
		/* selectEmailData */
		select usr_id
		     , usr_email 
		from tb_co_user tcu
		where 1=1
		  and (usr_id = #{data} or usr_email = #{data})
	</select>
	
	<select id="selectEmailKey" parameterType="sqlMap" resultType="integer">
		/* selectEmailKey */
		select nextval('tb_co_email_log_seq') as key
	</select>
	
	<insert id="insertMailSenderLogList" parameterType="sqlMap">
       insert into tb_co_email_log (
       		 email_log_seq
        	,email_send_biz_cd
        	,send_usr_id
        	,send_email
        	,email_ttl
        	,email_cntn
        	,send_dt 
        	,send_yn
		) values (
		     #{key}::integer
			,#{email_send_biz_cd}
			,#{send_usr_id}
			,#{send_email}
			,trim(BOTH FROM #{email_ttl}::text)
			,trim(BOTH FROM #{email_cntn}::text)
			,to_char(now(), 'YYYYMMDDHH24MISS')
			,#{send_yn}
		)
    </insert>
    
    <insert id="insertMailReciverLogList" parameterType="sqlMap">
       insert into tb_co_email_recv_log (
       		 email_log_seq
        	,recv_seq
        	,recv_type_cd
        	,recv_usr_id
        	,recv_email
		) values (
		     #{email_log_seq}::integer
			,#{recv_seq}::integer
			,#{recv_type_cd}
			,#{recv_usr_id}
			,#{recv_email}
		)
    </insert>
    
</mapper>