# 5장 JSP 웹프로그래밍
-----
## JSP 태그들
스크립트릿, 선언, 표현식 
JSP문서안에 JAVA언어를 넣기 위한 방식들 -> 이 세개를 묶어 scriptlet이라 한다

### 1. 스크립트릿(scriptlet) : <% java 코드 %> 	
코드블럭이라고도 합니다. jsp문서에서 자바코드를 작성하고싶다면 기본적으로 코드블럭 안에 작성해야 합니다.

### 2. 선언(declaration) :    <%! java 코드 기술 %>
변수 또는 메소드 선언할 때 사용. 여기서 선언된 변수 및 메소드는 페이지 어느곳에서나 사용가능한 전역의 의미로 사용된다. 자바에서 전역변수는 값을 할당하지 않고 선언만 해도 초기값이 있기때문에 사용가능한다든가의 차이.

스크립트릿은 자바스크립트와 같이 위에서부터 아래로 순서대로 실행이 된다. 변수를 아래에서 정의하면 에러난다. 그러나 예외가 선언부 <%! %> 이다.
자바에서도 선언적 함수는 아래에서 명시할수있었던것처럼 아래에서 선언부로 선언가능.

JSP에서의 지역변수와 전역변수의 차이
지역변수는 처음에 구동했을때 사용되고 메모리에서 사라진다. 전역변수는 메모리에 계속 올라와있기때문에 서버를 끄지않는이상 유지된다.

### 3. 표현식(expression) :   <%= java 코드 기술 %>
JSP 페이지 내에서 사용되는 변수의 값 또는 메소드 호출 결과값을 출력하기 위해 사용.
세미콜론을 사용하지 않는다.

### 4. 주석	:	<%--	 --%>
응답 페이지에서는 이 주석은 보이지 않는다. WAS에서 이 주석은 제거하고 응답페이지를 만든다. cf. HTML 주석과 JSP 주석과 비교해 보자
<%-- JSP 주석 --%>
<!-- HTML 주석 -->
페이지 소스보기를 해보면 HTML주석은 소스에서 보인다 ㅋㅋ

### 5. 지시자	:	<%@	%>
JSP페이지의 전체적인 속성을 지정할 때 사용.
page, include, taglib 가 있다

 - page : 해당 페이지의 전체적인 속성 지정. 주로 사용되는 언어 지정 및 import문을 많이 사용, 문서 타입(html, excel..)

<%@page import="java.util.Arrays"%>  // import해오는것 

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%> 
이 페이지는 자바언어로 이루어져있고 페이지 인코딩은 UTF-8로 할것이고 이 문서를 읽는 브라우저는 text/html charset=UTF-8로 읽으세요 라는 명시 

 - include : 별도의 페이지를 현재 페이지에 사용 (footer 등 모든 페이지에서 반복되는 작업들에 이용)

쿠팡사이트를 한번 훑어보자. 헤더,푸터 부분은 사이트내에서 이동을 해도 고정되어 있는것을 볼수있다. 그럼 모든 사이트에 헤더와 푸터를 명시해야할까? 코드의 중복이 심하고 비효율적이다. 그래서 하나만 만들고 include를 명시해서 가져오는것이다.

원하는 body 내의 지점에 아래의 지시자를 사용하면 
<%@include file="../main/footer.jsp" %>
해당 부분의 footer.jsp의 내용을 가져온다. 

단 여기서 주의할점이 footer.jsp에 적용되어있는 링크의 footer.css는 css선택자를 footer div 이런식으로 자세하게 선택자 지정해야한다. 그렇지 않고 div 이렇게 지정하면 모든 div가 지정이 되어버리기때문에 나중에 파일을 이런식으로 조각내서 가져오게되면 겉잡을수없이 찾기 힘들게 된다.

 - taglib : 태그라이브러리(사용자가 만든 tag들)의 태그 사용. 
태그라이브러리를 사용하기 위해 taglib지시자 사용. taglib 지시자에 대한 학습은 추후에 살펴볼 17장 JSTL(JSP stanard Tag Library)에서 배울 예정.
JSP 표준 태그 라이브러리 (아파치 재단에서 배포)
후에 이를 배우게 되면 편하게 사용할수 있는 태그를 이용할수 있다.


실습예제---------
숫자 입력시 누적합 출력

파라미터가 없을경우 출력없음

파라미터가 있을경우 (스페이스도 처리)
인풋타입 텍스트로 받고 trim()처리
-------
 - 액션태그
---------------------------
## JSP 내부객체 (중요)

### 대표적인 내부 객체
 - 입출력 객체 : request, response, out
 - 서블릿 객체 : application, page, config
 - 세션 객체 : session
 - 예외 객체 : exception

request, response, session  이 3개의 객체는 mvc패턴에서도 엄청 중요하다

-----
### 1. request 객체 
웹브라우저를 통해 서버에 어떤 정보를 요청하는 것을 request라 하며, 이러한 요청 정보는 request 내부객체가 관리한다

 - request.getRemoteAddr(); 웹서버에 연결한 클라이언트의 IP주소

IPv4 방식의 아이피주소를 사용했었다. 4자리의 255갯수 (1바이트) -- 42억개밖에 안된다. 냉전시대에 생긴 옛날 방식. 
유동 아이피 : skt텔레콤등 회원수가 1천만이라 치면 아이피 100만개를 돌려쓰는것
보통 회사컴퓨터는 고정아이피

아이피 가짓수가 너무 부족해서 IPv6 방식이 새로 나옴. 윈도우7이상은 기본이 IPv6

그래서 IPv4로 사용하고싶으면 이클립스에서 Run Configurations 옵션을 만져야한다.노트폴더에 추가작성.

 - request.getContextPath() : contextPath를 리턴
이걸 활용하여 문서 최상단에 String 변수에 담아놓고 css불어올때 사용할수있다
"../css/footer.css" 이런식으로 하면 디렉토리 별로 적용이 안될수가 있기에 이런식으로 하는게 가장 안정성있다.

 - 요청 방식 : request.getMethod()  get방식인지 post방식인지
 - 세션 객체 : request.getSession()
 - 요청 URL : request.getRequestURL()  url 리턴
 - 요청 URI : request.getRequestURI()  uri 리턴
 - 서버 이름 : request.getServerName()
 - 포트번호 : request.getServerPort()
 - 해당 프로토콜 : request.getProtocol()

기본적으로 톰캣은 post방식으로 데이터 전송시 utf-8로 인코딩되지않기때문에 
request.setCharacterEncoding("utf-8"); 메소드를 사용해줘야한다.

코드 수정시 서블릿은 서버를 재부팅해야하지만 JSP는 알아서 적용이된다.

서블릿은 url 주소에서 .java생략가능
JSP는 생략불가능 

클라이언트ip를 얻는 방법을 통해 실제로 글쓴이의 ip를 db에 저장이 가능

uri 와 contextpath를 얻는방법을 이용해 
클라이언트가 어느 url을 가든지 writer.do, join.do, delete.do 등
하나의 서블릿에 매핑을 (*.do) 로하면 한곳에 모이는데
uri를 구해서 subString을 하면 어디서왔는지 확인이 되기때문에 분류가 가능하다.

-----
### 2. response 객체 
웹브라우저의 요청에 응답하는 것을 response한다고 하며, 이러한 응답(response)의 정보는 response 내부객체가 갖고 있다.

 - setCharacterEncoding() : 응답할때 문자의 인코딩.
 - addCookie(Cookie) : 쿠키를 지정.
 - sendRedirect(URL) : 지정한 URL로 이동

자바스크립트에서는 location객체로 간단하게 쓸수있지만 자바에서는 복잡해지기때문에 간단하게 리스폰객체를 불러서 사용가능.

첫페이지에서 사용자에게 나이를 입력받고 
중간(2번째) 사이트에서 나이에 따른 분류로 response.sendRedirect("url")를 이용해서 각 다른 (3번째)사이트로 이동시킨다.

여기서 재밌는점은 3번째 페이지에서 history.back() 뒤로가기를 사용하면 
2번째페이지로 가는게아니고 첫번째페이지로간다. 브라우저는 2번째 페이지를 로드하지않았기때문.

------
id , pw 확인 예제
첫번째 사이트에서 사용자에게 입력받고 
두번째 사이트에서 파라미터로 값을 받고 자바로 if 확인한다 
제대로 쳣다면 밑에 메세지를 출력하고 잘못쳣다면 response.sendRedirect()를 사용해 다시 전사이트로 보내는데 msg를 파라미터로 줘서 첫번째 사이트에서 잘못쳣다고 알린다. 

한글 깨짐 오류 
String msg = "아이디와 비밀번호를 확인하세요";
msg = URLEncoder.encode(msg,"utf-8");
java.net 의 라이브러리 URLEncoder를 사용한다.
-----
평가2문제 중 1번
난수발생
버튼 3개
수를 매개변수로 가지고 두번째사이트로 이동
정답이라면 두번째사이트에서 출력
틀렷다면 첫번째사이트로 리다이렉트 돌아가서 msg 갖고 돌아가서 문자출력

평가2문제중 2번
어제했던 join.html 회원가입 예제 jsp로 구현+추가
어려울건없었다.













---구글검색
jsp 액션태그
-----복습
자바에서 메인 함수 내에서 변수 선언을 하면 함수 내에서는 지역 변수로 선언이 된다.
값을 할당하지 않으면 초기값이 없기때문에 사용할수가 없고 에러가 난다.
그러나 전역변수(클래스 멤버 변수)는 값을 지정하지않고 선언해도 기본 초기값이 있기때문에 에러가 나지않는다.

자바에서 String은 값을 변경해도 그 값이 바뀌는게 아니라 객체를 새로생성해서 메모리를 과소비한다. StringBuffer나 Stringbuilder 를 사용하면 이런 문제를 해결할수 있다.

지역변수는 처음 구동시에 사용되고 메모리에 사라진다. 전역변수는 서버를 끄기전까지는 계속 메모리에 올라와있다. 변수에 ++ 같은거라도 하면 새로고침할때마다 증가하는걸 볼수있다. 그러나 소스를 수정하고 재컴파일하게되면 그때는 전역변수도 초기화된다.

--경로--
/   루트
context_path    프로젝트영역
/dir      그 아래 디렉토리영역  혹은 서블릿매핑도 이 정도 순서에서 나옴
파일명

