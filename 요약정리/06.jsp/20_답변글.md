# 답변글

기존에 있던 글에 답변글을 달면 기존 리스트 순서를 무시하고 해당 원글의 아래쪽에 답변글이 달리는 기능

이 기능을 위해서는 테이블을 설계할 때부터 컬럼을 추가로 3개나 만들어야 합니다.  
ref, re_step, re_indent

이를 위한 공식은 다음과 같습니다.

1. num(글번호(pk))은 글 생성시 자동으로 1씩 증가
2. ref는 원글(답변글이 아닌)이면 num과 같고, 답변글이면 원글의 ref와 같다.
3. re_step은 원글이면 0, 답변글이라면 다음과 같이 진행한다.  
  1. ref가 같고 원글보다 re_step가 큰 값이 있으면 그 글들은 re_step을 +1
  2. 답변글 re_step는 원글보다 +1
4. re_indent는 원글이면 0, 답변글이면 원글의 +1

말로 보면 복잡할수 있는데 원글의 아닌 글들은 모두 최상위 원글과 같은 ref를 가지는 그룹이 되는것이고, 그 그룹내에서 순서를 정렬하는 것이다.

답변글을 작성시 해당 원글에 이미 답변글이 있는 경우는 기존 답변글들의 re_step을 1씩 늘려서 전부 아래쪽으로 밀어내고 자신은 원글의 +1 로 끼어드는것.

re_indent는 들여쓰기 정도레벨인데, 그냥 작성시에 원글보다 +1만큼만 많으면 된다.

## 쿼리 수정

이제 쿼리도 추가로 수정해야 합니다.

1. 답변글에 따라서 출력하는 모양새가 기존과 다를테니 목록 출력하는 쿼리를 만지고
2. 글을 추가할때 답변글을 추가하는 로직이 필요합니다.

글목록 출력하는 쿼리 수정은 사실 쉽습니다. 그냥 order by 절에 ref순으로 출력하고 만약 ref가 같다면 re_step순으로 출력합니다.

답변글을 다는 쿼리는 2개가 필요합니다.

1. 기존 답변글(만약 원글에 이미 답글이 달려있는 경우)을 step+1 하는 update문  
원글과 ref가 같고, 원글의 step보다 큰 데이터들만 수정

2. 새 답변글을 적는 insert문 (원글의 ref,re_step,re_indent 정보가 필요)  
원글과 ref가 같아야 하고, 원글에 비해 step,indent가 +1 해야함

쿼리문을 작성했으면 dao에서 기능을 추가하고 list.jsp문서에서 글목록을 출력할 때 
indent가 0보다 크다면 추가로 들여쓰기를 조정해줘야 합니다. (이번에는 이미지 width로 조정했습니다)

답변글을 쓰기 위해서는 원글의 정보가 필요한데 글상세보기페이지 -> 답글쓰기 버튼 -> 글쓰기form 문서로 접근시 글번호(num) 매개변수를 전송하게 설정해서 원글의 번호를 이용해 정보를 구할수 있습니다.

답변글이 아닌 새글이라면 매개변수가 없을것일테니 기존의 글추가 메서드를 활용하고, 답변글이라면 답변글 메서드를 활용하면 됩니다.












