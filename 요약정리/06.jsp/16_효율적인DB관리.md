# 12장 효율적인 DB 관리

### DAO : Data Access Object

- 데이터 베이스에 접속해서 데이터 추가, 삭제, 수정 등의 작업을 하는 클래스입니다

- 일반적인 JSP 혹은 Servlet 페이지 내에 위의 로직을 함께 기술할 수도 있지만, 유지보수 및 코드의 모듈화를 위해 별도의 DAO클래스를 만들어 사용합니다

### DTO : Data Transfer Object

DAO 클래스를 이용하여 데이터 베이스에서 데이터를 관리할 때 데이터를 일반적인 변수에 할당하여 작업 할 수도 있지만,  
해당 데이터의 클래스 객체를 만들어 사용합니다.   
데이터만 하나로 모아 객체에 담는 용도입니다.

DAO(Data Access Object), DTO(Data Transfer Object)
DAO라는 리모콘으로 원하는 기능을 실행하면  
DTO라는 그릇으로 데이터를 옮겨서 로직을 수행합니다.


1. 사용할 테이블에 맞춰 dto를 만든다 
emp,dept 테이블 두개를 사용할것이기때문에 dto를 2개만든다
나중에 사용자로부터 입력받을때 bean태그를 사용하기때문에 매개변수없는 생성자함수도 꼭 만들어놓고, getter,setter도 반드시 구현해놓자
toString도 구현하는게 좋다 

2. 필요한 로직에 따라 dao를 만든다
dao는 싱글톤클래스로 만든다. 생성자함수에 드라이버로드
원하는 로직들을 메소드로 구현

이제 dao와 dto를 이용해서 훨씬 간단하게 작성할수있다










커넥션풀(Connection Pool)

클라이언트에서 다수의 요청이 발생할경우 데이터베이스에 부하가 발생하게 된다.(커넥션 연결이 가장 오래걸림(db와 was는 서로다른 컴퓨터에 있는 경우도 있음))
이러한 문제를 해결하기 위해 커넥션 풀 기법을 이용한다.
커넥션 객체를 미리 많이 만들어 준비한다.

-------
이름똑같이 만들면 dto에 자바빈태그를 바로 적용할수있는데
기초데이터타입이아닌것들. 예를들어 Date형은 예외(이름다르게하자)
원래 자바빈 태그는 편리하게 알아서 형변환도 다해서 클래스에 setter해준다.
매개변수가없으면 "" 빈문자열로 넘어가는데 빈태그가 null로 알아서 변환해줌

bean태그를 사용해서 매개변수(String)들을 전부 편하게 setProperty 하는 와중에
Date는 String에서 변환을 못하기때문에 에러가난다. 그래서 문제있을만한 매개변수는 이름을 다르게하고 내가 직접 세터해야한다.
매개변수 받아서 Date.valueOf() 로 문자열을 데이트형으로 변환
Timestamp 형은 시간까지 포함해야함 뒤에 "00:00:00" 라고 시간을 표현한 문자열을 추가
-------
jsp태그는 닫는태그없으면 /> 이렇게 해도 됐었지만
html태그는 반드시 정해진대로 사용해야함
<script src="경로"></script> 이렇게 되야함
---

-------------------------------------------------
## 회원정보수정 ★
다른건 다 그냥저냥 만들기쉬운데
회원정보수정페이지가 제일 만들기빡세다
만약 정보가있다면 해당 정보에 맞는 값들을 미리 입력해놔야한다.
checked, selected 등 전부 확인해야한다
회원정보를 수정하려면 로그인상태일테니 member객체가 session에 속성으로 존재할것이다. 세션에 접근해서 객체를 가져온다.

미리 출력해놓을 값은 객체에서 값을 출력(비번은 출력안함)
아이디는 못바꿈 값만 적고 readonly="readonly"

현재비밀번호(name은 빈태그와 다르게 왜냐면 pw는 수정할 매개변수이기때문에)는 입력받는게 맞아야함.
바꿀비밀번호(pw)는 안적으면 안바꿈, 적으면 바꿈
비밀번호확인(pwChk)도 있어야함
이름까지는 꼭 필수입력이라 required="required"필요

전화번호도 이런식으로 조건이 맞을때만 선택하거나 값을출력하게 하기
<option <%if("010".equals(phone1)){out.print("selected='selected'");} %>>010</option>
<input type="text" name="phone2" value='<%=phone2==null?"":phone2%>'> -

성별도 조건에따라 다르게 출력 
<%
if("m".equals(gender)){
	%>
	<input type="radio" name="gender" value="m" checked="checked">남
	<input type="radio" name="gender" value="f">여
	<%
}else if("f".equals(gender)){
	%>
	<input type="radio" name="gender" value="m">남
	<input type="radio" name="gender" value="f" checked="checked">여
	<%
}else{
	%>
	<input type="radio" name="gender" value="m">남
	<input type="radio" name="gender" value="f">여
	<%
}
%>

이메일은 간단하게 삼항연산자로 null이면 빈문자열출력
<input type="email" name="email" value='<%=email==null?"":email%>'>

생년월일은 매개변수가 이름이 달라야한다 자바빈태그랑 이름이같으면 자동형변환이 안되서 에러난다 우리가 수동형변환해야하고 따로 세팅해야됨
<td><input type="date" name="tempBirth" value='<%=birth==null?"":birth.toString()%>'></td>
출력도 toString해줘야한다 

주소도 간단하게 삼항연산자로 출력

----
회원정보수정체크페이지도 빡셈
tempBirth를 받아서 "" 빈문자열이 아니면 dto에 setBirth해서 집어넣는데 Date.valueOf(tempBirth)를 사용해야한다
원래 dto에 있는 이름들은 자바빈태그로 한번에 받아온다.

이제 비번이 문제인데 
일단 oldPw를 체크하고 현재비밀번호를 잘못치면 history.back()으로 빠꾸한다
만약 제대로 쳣다면
pw를 안쳤다면(null이라면) 비밀번호수정을 안함(pw를 oldpw값으로 다시수정)

이제 정보수정처리를 하면됨 Dao불러서 메소드 호출
정보수정실패시 경고문띄우고 다시 페이지보냄

정보수정 성공시 세션도 다시 덮어씌워서 정보갱신시키고 페이지전환




















